webpackJsonp([29],{1417:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=a(600),r=n(l),s=a(1418),u=n(s),i=a(776),o=n(i),c=a(777),d=n(c),p=a(785),h=n(p),f=r.default.createClass({displayName:"App",getInitialState:function(){return{current:1,tableData:{loading:!0,data:[],pagination:null}}},tableData:function(e){var t=this;this.setState({tableData:{loading:!0}});var a=o.default.listGroups;a=d.default.makeUrl(a,e),h.default.get(a,function(e){var a=e.value.result;a.map(function(e,t){a[t].key=t}),t.setState({tableData:{data:a,loading:!1,pagination:{total:e.value.amount,current:t.state.current,pageSize:10,showSizeChanger:!1,onChange:function(e){var a={index:e};t.setState({current:e}),t.tableData(a)}}}})})},componentDidMount:function(){var e={index:1};this.tableData(e)},render:function(){return r.default.createElement("div",null,r.default.createElement(u.default,{homeCurrent:this.state.current,current:this.state.current,refresh:this.state.refresh,tableDataList:this.state.tableData,onSearch:this.tableData}))}});e.exports=f},1418:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=a(600),r=n(l),s=a(783),u=a(776),i=n(u),o=a(785),c=n(o),d=a(777),p=n(d),h=a(1419),f=n(h),m=a(799),g=n(m),b=a(1420),v=n(b),S=a(1421),A=n(S),I=s.Form.Item,E=s.Select.Option,y=r.default.createClass({displayName:"AddAppTask",getInitialState:function(){return{initData:{},searchAuth:"all",selectAll:!1,current:1,searchCurrent:1,values:[],subAccountTitle:"全部子账号",authData:{appList:[]},tableData:{loading:!0,data:[],pagination:null},appIds:[],data:null,noticeBarType:"0",noticeExpandType:"0",pushTimeType:"0",appName:"全部应用",appId:0,errors:{},defaultAppid:"应用",randomUser:1}},handleSubmit:function(e){e.preventDefault(),this.props.form.validateFields(function(e,t){return e?void console.log("Errors in form!!!"):(t.noticeBarInfo={noticeBarType:t.noticeBarType,title:t.title,content:t.content,noticeBarImgUrl:t.noticeBarImgUrl},delete t.noticeBarType,delete t.title,delete t.content,delete t.noticeBarImgUrl,void c.default.post(i.default.addNotice,t,function(){s.message.success("提交成功")}))})},componentWillMount:function(){var e=this,t=p.default.queryString("id",window.location.href);t&&e.props.form.setFieldsValue({appId:t})},changeRadio:function(e){var t={};t[e.target.name]=e.target.value,this.setState(t)},textInput:function(){},allSubAccount:function(){},createSubAccount:function(){},getAllSubAccountTable:function(e,t,a){var n=this,l=i.default.searchAppGroup,r={index:a,pageSize:10};if(e.name)r.groupId=e.id;else{var s=e.searchAuth||this.state.searchAuth;s&&"all"!==s&&(r.groupId=s)}var u=e.searchValue||this.state.searchValue;u&&"0"!==u&&(r[this.state.searchType||"appId"]=u),l=p.default.makeUrl(l,r),c.default.get(l,function(l){for(var s=l.value.result,u=0;u<s.length;u++)s[u].key=s.appId;n.setState({selectAll:!1,searchAuth:r.groupId||"all",tableData:{data:s,loading:!1,pagination:{total:l.value.amount,current:a,pageSize:10,showSizeChanger:!1,onChange:function(a){n.setState({current:a,searchCurrent:a}),e[t]=!0,n.getAllSubAccountTable(e,t,a)}}}})})},toggleModal:function(e,t){var a=this,n={},l=this.state[e];if(n[e]=!l,n.editData=t,"allSubAccount"===e&&(l?this.setState({searchValue:0,searchAuth:null,changeAuth:null}):(n.searchCurrent=1,this.getAllSubAccountTable(t,e,1),this.setState(n))),"createSubAccount"===e){var r=i.default.getGroupRegistInfo,s={};r=p.default.makeUrl(r,s),c.default.get(r,function(e){var t=e.value;n.authData=t,a.setState(n)})}l&&this.setState(n)},onSearchFlyme:function(e,t){var a=this.state.editData,n=this;t&&0!=t||(t=1,this.setState({searchCurrent:t,current:t}));var l=i.default.searchRoleAccount,r={roleId:a.id,index:t||this.state.searchCurrent,pageSize:10},s=this.state.flymeAccount||e.flymeAccount;s&&(r.flymeAccount=s),l=p.default.makeUrl(l,r),c.default.get(l,function(l){for(var r=l.value.result,s=0;s<r.length;s++)r[s].key=s;n.setState({flymeAccount:e.flymeAccount,editData:a,tableData:{data:r,loading:!1,pagination:{total:l.value.amount,current:t||n.state.searchCurrent,pageSize:10,showSizeChanger:!1,onChange:function(t){n.setState({searchCurrent:t,current:t}),n.onSearchFlyme(e,t)}}}})})},changeType:function(e,t){var a={};a[e]=t,this.setState(a),"searchAuth"===e&&this.getAllSubAccountTable({searchAuth:t},"allSubAccount",1)},selectType:function(e,t){this.props.form.setFieldsValue({appId:e}),this.setState({appId:e,appName:t}),0!=e&&this.setState({searchValue:e||0}),"number"==typeof e&&(e=t),this.getAllSubAccountTable({searchValue:e},"allSubAccount",1)},getAppIds:function(e){this.setState({appIds:e})},componentDidMount:function(){var e=this.props.tableDataList.data,t="";e&&e.length&&(t=String(e[0].id),this.setState({changeAuth:t}))},selectAll:function e(t){var a=t.target.checked,n=this.state.tableData.data,e=!0,l=[];n.map(function(e){l.push(e.appId)}),a||(l=[],e=!1),this.setState({selectAll:e,appIds:l})},changeGroup:function(){var e=this,t=i.default.changeGroup,a=this.state.appIds;if(!a.length)return void s.message.error("请选择应用");var n={appList:JSON.stringify(a),groupId:this.state.changeAuth};c.default.post(t,n,function(){s.message.success("权限组转换成功"),e.getAllSubAccountTable(n,"allSubAccount",e.state.searchCurrent),e.setState({appIds:[],selectAll:!1}),e.props.onSearch({index:e.state.homeCurrent||1})})},render:function(){var e=this,t=this,a={api:i.default.listUserApp,width:"190",all:"全部应用",appName:this.state.appName,name:"appId",appId:this.state.appId},n=this.props.tableDataList.data,l=[r.default.createElement(E,{key:"all",value:"all"},"全部权限组")],u=[];n&&n.length&&n.map(function(e,t){u.push(r.default.createElement(E,{key:"auth1"+t,value:String(e.id)},e.name))}),n&&n.length&&n.map(function(e,t){l.push(r.default.createElement(E,{key:"auth2"+t,value:String(e.id)},e.name))});var o="";return n&&n.length&&(o=String(n[0].id)),r.default.createElement("div",null,r.default.createElement(s.Form,{horizontal:!0},r.default.createElement(s.Row,{className:"home_toolbar"},r.default.createElement(s.Col,{span:"8"}),r.default.createElement(s.Col,{span:"9"}," "),r.default.createElement(s.Col,{span:"7",className:"ta_r"},r.default.createElement(s.Button,{type:"primary",onClick:this.toggleModal.bind(this,"createSubAccount"),className:"btn_normal_show color_bg ml10",size:"large"},"新建权限组"),r.default.createElement(s.Button,{type:"primary",onClick:this.toggleModal.bind(this,"allSubAccount"),className:"btn_normal_show color_bg ml10",size:"large"},"全部应用搜索"))),this.state.allSubAccount&&r.default.createElement(s.Modal,{width:1e3,title:"全部应用",footer:null,visible:!0,onOk:this.delOk,onCancel:this.toggleModal.bind(this,"allSubAccount")},r.default.createElement("div",{className:"sub_account_search"},r.default.createElement("span",{className:"fs14"},"权限组"),r.default.createElement(I,{className:"display_ib mr10 ml10"},r.default.createElement(s.Select,{onChange:function(t){return e.changeType("searchAuth",t)},value:String(this.state.searchAuth),style:{width:200}},l)),r.default.createElement("div",{className:"fr "},r.default.createElement(I,{className:"display_ib mr10"},r.default.createElement(s.Select,{onChange:function(t){return e.changeType("searchType",t)},defaultValue:"appId",style:{width:105}},r.default.createElement(E,{value:"appId"},"按应用搜"),r.default.createElement(E,{value:"packageName"},"按包名搜"),r.default.createElement(E,{value:"pushAppId"},"按AppID搜"))),r.default.createElement(I,{className:"display_ib mr10"},r.default.createElement(g.default.render,{searchType:this.state.searchType,notFoundContent:"无数据",showSearch:!0,searchPlaceholder:"搜索应用名称",selectType:this.selectType,initData:a})))),r.default.createElement(f.default,{homeCurrent:this.props.homeCurrent,homeTable:this.props.onSearch,editData:this.state.editData,getAppIds:this.getAppIds,appIds:this.state.appIds,selectAll:this.state.selectAll,current:this.state.current,searchCurrent:this.state.searchCurrent,onSearchFlyme:this.onSearchFlyme,type:"allSubAccount",getAllSubAccountTable:this.getAllSubAccountTable,authData:this.state.authData,toggleModal:this.toggleModal,self:t,refresh:this.state.refresh,tableData:this.state.tableData}),r.default.createElement("div",{className:"ml10 fs14"},r.default.createElement(s.Checkbox,{checked:this.state.selectAll,onChange:this.selectAll},"全选")),r.default.createElement("div",{className:"mt10 ml10"},r.default.createElement("span",{className:"fs14"},"转换权限组"),r.default.createElement(I,{className:"display_ib mr10 ml10"},r.default.createElement(s.Select,{onChange:function(t){return e.changeType("changeAuth",t)},defaultValue:o,style:{width:200}},u)),r.default.createElement(s.Button,{type:"primary",onClick:this.changeGroup,className:" color_bg ml10",size:"large"},"确定"))),this.state.createSubAccount?r.default.createElement(v.default,{onSearch:this.props.onSearch,editData:this.state.editData,authData:this.state.authData,toggleModal:this.toggleModal,self:t,createSubAccount:this.state.createSubAccount}):null),r.default.createElement(A.default,{homeCurrent:this.props.homeCurrent,toggleModal:this.toggleModal,refresh:this.props.refresh,onSearch:this.props.onSearch,tableData:this.props.tableDataList}))}});y=s.Form.create()(y),e.exports=y},1419:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=a(600),s=n(r),u=a(783),i=a(777),o=n(i),c=s.default.createClass({displayName:"App",getInitialState:function(){return{createSubAccount:!1,selectStatus:!1,current:1,dataSource:null,pagination:null,refresh:!1}},columns:function(){var e=this;return[{title:"应用名称",key:"0",className:"ta_l",dataIndex:"appName",render:function(t,a){var n=e.props.appIds,l=!1;return n.map(function(e){e===a.appId&&(l=!0)}),e.props.selectAll&&!e.state.selectStatus&&(l=!0),s.default.createElement(u.Checkbox,{checked:l,data:a,onChange:e.onChange},s.default.createElement("span",{className:"pl10 fs14"},s.default.createElement("img",{className:"va_m mr10",src:a.appUrl||o.default.cdn+"/resources/push/images/default_icon.png",width:"24",height:"24"}),t))}},{title:"应用包名",key:"1",className:"ta_l",dataIndex:"packageName"},{title:"AppId",key:"2",className:"ta_c",dataIndex:"pushAppId"},{title:"权限组名称",key:"3",className:"ta_c",dataIndex:"groupName"}]},onChange:function(e){var t=e.target.checked,a=e.target.data.appId,n=this.props.appIds;t?n.push(a):n.map(function(e,t){e===a&&n.splice(t,1)}),console.log(n),this.props.getAppIds(n),this.setState({selectStatus:!0})},componentWillMount:function(){},togglePopover:function(e){this.setState(l({},"visible"+e,!this.state["visible"+e]))},toggleModal:function(){this.setState({showMainAccountModal:!this.state.showMainAccountModal})},render:function(){return s.default.createElement("div",null,s.default.createElement(u.Table,{columns:this.columns(),loading:this.props.tableData.loading,dataSource:this.state.dataSource||this.props.tableData.data,pagination:this.state.pagination||this.props.tableData.pagination}))}});e.exports=c},1420:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s=a(600),u=n(s),i=a(783),o=a(776),c=n(o),d=a(777),p=n(d),h=a(785),f=n(h),m=a(799),g=n(m),b=i.Form.Item,v={labelCol:{span:5},wrapperCol:{span:19}},S=u.default.createClass({displayName:"App",getInitialState:function(){return{editDataDetail:{},jsonDataCustom:[],parentId:{},scope:"0",liClass:"",loading:!1,appName:"",jsonData:[],authData:[],authChecked:[],createSubAccount:this.props.createSubAccount}},componentWillMount:function(){},componentDidMount:function(){var e=this,t=[],a=this.props.editData;if(a&&a.name){var n=c.default.getGroupModuleInfo;n=p.default.makeUrl(n,{groupId:a.id}),f.default.get(n,function(t){var a=t.value,n={},l=a.moduleIdList||[];l.map(function(e){n["checkedauth"+e]=!0});var r=String(a.scope);"2"===r?n.selectAppStatus=!0:n.appId=0,Object.assign(n,{editDataDetail:a,scope:r,jsonData:l}),e.setState(n)})}else this.setState({jsonData:t})},validate:function(e){var t=this.props.form.getFieldProps,a=this.props.editData;return t(e,{initialValue:a&&a.name||"",validate:[{rules:[{required:!0,message:"请输入应用权限组名称 "},{validator:function(e,t,a){t&&t.length>=4&&t.length<=32&&t.match(/^\s/)?a(new Error("行首不能输入空格")):a()}}],trigger:["onBlur","onChange"]}]})},createAccount:function(){var e=this;this.props.form.validateFields(function(t,a){var n=e.state.jsonData;if(t)return void console.log("Errors in form!!!");var l={groupName:a.groupName,moduleIdList:JSON.stringify(n)},r=e.props.editData,s="新建成功",u=c.default.createGroup;r.name&&(l.groupId=r.id,u=c.default.editGroup,s="编辑成功"),f.default.post(u,l,function(){i.message.success(s),e.props.toggleModal("createSubAccount",r),e.props.onSearch({index:1})})})},changeManage:function(e,t){var a,n=this.state.jsonData,r=!this.state["checkedauth"+t.id],s=this.state.appId,u=this.state["authChecked"+s]||[];r?u.push(1):u.pop();for(var i=!1,o=n,c=0;c<o.length;c++)o[c]===t.id&&(i=!0,r||o.splice(c,1));i||o.push(t.id),this.setState((a={jsonData:o},l(a,"authChecked"+s,u),l(a,"checkedauth"+t.id,!this.state["checkedauth"+t.id]),a))},getAppName:function(e){for(var t=g.default.allApp,a=0;a<t.length;a++)if(t[a].appId===e)return t[a].name},render:function(){var e=this,t=this,a=this.state.editDataDetail,n="";n=a.groupName?"编辑应用权限组":"添加应用权限组";var l=this.props.authData,s=[];l.map(function(e,a){var n=e.childModuleList,l=null;n&&n.length>0&&(l=n.map(function(e,a){return u.default.createElement(i.Col,{span:"6",key:a},u.default.createElement("label",null,u.default.createElement(i.Checkbox,{checked:t.state["checkedauth"+e.id],onChange:function(a){return t.changeManage(a,e)}}),u.default.createElement("span",null,e.name)))})),s.push(u.default.createElement(i.Row,{key:a},u.default.createElement(i.Col,{className:"color999",span:"3"},e.name),u.default.createElement(i.Col,{span:"21"},l)))});var o=this.props.editData&&t.props.editData.appId;return this.props.createSubAccount?u.default.createElement(i.Modal,{zIndex:"1008",width:900,title:n,visible:!0,onOk:this.createAccount,onCancel:function(){return e.props.toggleModal("createSubAccount",{appId:o})}},u.default.createElement(i.Form,{style:{paddingTop:20},horizontal:!0},u.default.createElement(i.Row,null,u.default.createElement(i.Col,{span:"24"},u.default.createElement(b,r({},v,{label:"名称    "}),u.default.createElement(i.Input,r({style:{width:300},placeholder:"4-32个字符"},this.validate("groupName")))),u.default.createElement(b,r({},v,{label:"权限范围    "}),s))))):null}});S=i.Form.create()(S),e.exports=S},1421:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=a(600),s=n(r),u=a(783),i=a(776),o=n(i),c=a(785),d=n(c),p=s.default.createClass({displayName:"ManageTabel",getInitialState:function(){var e=this;return{showMainAccountModal:!1,columns:[{title:"名称",key:"0",dataIndex:"name",render:function(e,t){return s.default.createElement("span",{className:t.isEnable?"":"colord9"},e)}},{title:"应用",key:"1",dataIndex:"appNum",render:function(t,a){return s.default.createElement("div",null,s.default.createElement("a",{onClick:function(){return e.showSubAccount(a)},href:"javascript:;"},t))}},{title:"操作",key:"2",className:"ta_c",dataIndex:"subAccountNum",render:function(t,a,n){var l=a.isEnable?"i_disable":"i_undisable",r=a.isEnable?"禁用":"启用";return s.default.createElement("div",{className:"btn_wrap"},s.default.createElement(u.Tooltip,{title:"编辑"},s.default.createElement("i",{onClick:function(){return e.props.toggleModal("createSubAccount",a)},className:"i_edit"})),s.default.createElement(u.Tooltip,{title:r},s.default.createElement("i",{onClick:e.disabledAccount.bind(e,a.id,a.isEnable,n),className:l})),1===a.canDel&&s.default.createElement(u.Tooltip,{title:"删除"},s.default.createElement(u.Popover,{placement:"bottom",visible:e.state["visible"+a.id],content:e.getContent(a.id,n),title:"确定删除该权限组?",onVisibleChange:e.togglePopover.bind(e,a.id),trigger:"click"},s.default.createElement("i",{onClick:e.togglePopover.bind(e,a.id),className:"i_del"}))))}}],refresh:!1}},togglePopover:function(e){this.setState(l({},"visible"+e,!this.state["visible"+e]))},modifyAccount:function(e,t,a){var n={managerName:e,managerId:t,appId:a};this.toggleModal("createSubAccount",n)},disabledAccount:function(e,t){var a=this,n=o.default.changeGroupStatus,l={groupId:e,status:t?0:1};d.default.post(n,l,function(){a.props.onSearch({index:1})})},delAccount:function(e){var t=this,a=o.default.delGroup,n=this,l={groupId:e},r=n.props.editData;r&&r.appId&&(l.appId=r.appId),d.default.post(a,l,function(){u.message.success("删除成功"),t.props.onSearch({index:1})})},getContent:function(e,t){return s.default.createElement("div",null,s.default.createElement(u.Button,{type:"primary",className:"color_bg mr10",onClick:this.togglePopover.bind(this,e)},"取消"),s.default.createElement(u.Button,{onClick:this.delAccount.bind(this,e,t)},"确定"))},toggleModal:function(e,t){var a={showMainAccountModal:!this.state.showMainAccountModal};t&&(a.mainAccount=t.name,a.appId=t.appId,a.mainAccountId=t.mainAccountId),this.setState(a)},showSubAccount:function(e){this.props.toggleModal("allSubAccount",e)},render:function(){return s.default.createElement("div",null,s.default.createElement(u.Table,{columns:this.state.columns,loading:this.props.tableData.loading,dataSource:this.props.tableData.data,pagination:this.props.tableData.pagination}))}});e.exports=p}});