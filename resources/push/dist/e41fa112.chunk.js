webpackJsonp([23],{1381:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}var n=a(600),r=l(n),s=a(1382),i=l(s),o=a(1384),d=l(o),c=a(776),u=l(c),f=a(777),p=l(f),m=a(785),h=l(m),b=r.default.createClass({displayName:"App",getInitialState:function(){return{current:1,tableData:{loading:!0,data:[],pagination:null}}},setTableDataDisable:function(e){var t=this.state.tableData.data;t.map(function(t,a){var l=t.disable;a===e&&(t.disable=!l)}),this.setState({tableData:{data:t}})},tableData:function(e){var t=this,a=p.default.queryString("appId",window.location.href);this.setState({tableData:{loading:!0}});var l=u.default.blackList;l=p.default.makeUrl(l,e),h.default.get(l,function(l){var n=l.value.result;n.map(function(e,t){n[t].key=t}),t.setState({tableData:{data:n,loading:!1,pagination:{total:l.value.amount,current:t.state.current,pageSize:10,showSizeChanger:!1,onChange:function(l){var n={appId:a,index:l};e.blackName&&(n.blackName=e.blackName),t.setState({current:l}),t.tableData(n)}}}})})},componentDidMount:function(){var e=p.default.queryString("appId",window.location.href);this.setState({appId:e})},render:function(){return r.default.createElement("div",null,r.default.createElement(d.default,{tableData:this.state.tableData,getTableData:this.tableData}),r.default.createElement(i.default,{setTableDataDisable:this.setTableDataDisable,current:this.state.current,refresh:this.state.refresh,tableData:this.state.tableData,getTableData:this.tableData}))}});e.exports=b},1382:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},r=a(600),s=l(r),i=a(783),o=a(1383),d=l(o),c=a(777),u=l(c),f=i.Form.Item,p={labelCol:{span:6},wrapperCol:{span:18}},m=s.default.createClass({displayName:"BlackToolbar",getInitialState:function(){return{data:null,value:"",searchStatus:!1}},onSearch:function(){var e=u.default.queryString("appId",window.location.href),t=this.props.form.getFieldValue("blackNameSearch"),a={appId:e,index:1};t&&(a.blackName=t),this.props.getTableData(a)},render:function(){var e=this.props.form.getFieldProps;return s.default.createElement(i.Form,null,s.default.createElement("div",{className:"sub_toolbar config_toolbar"},s.default.createElement(i.Row,null,s.default.createElement(i.Col,{span:"4"},s.default.createElement("div",{className:"title"},s.default.createElement("span",{className:"border"}),"黑名单列表")))),s.default.createElement(i.Row,{className:"mt10"},s.default.createElement(i.Col,{span:"8"},s.default.createElement(f,n({},p,{label:"黑名单名称"}),s.default.createElement(i.Input,e("blackNameSearch")))),s.default.createElement(i.Col,{span:"6"},s.default.createElement(i.Button,{className:"ml10",type:"primary",onClick:this.onSearch,size:"large"},"查询"))),s.default.createElement(d.default,{setTableDataDisable:this.props.setTableDataDisable,blackName:this.props.form.getFieldValue("blackNameSearch"),current:this.props.current,tagName:this.state.tagName,getTableData:this.props.getTableData,refresh:this.props.refresh,tableData:this.props.tableData}))}});m=i.Form.create()(m),e.exports=m},1383:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},s=a(600),i=l(s),o=a(783),d=a(776),c=l(d),u=a(777),f=l(u),p=a(785),m=l(p),h=o.Radio.Button,b=o.Radio.Group,g=o.Form.Item,v={labelCol:{span:4},wrapperCol:{span:20}},k=i.default.createClass({displayName:"App",getInitialState:function(){return{record:{},refresh:!1,status:0}},createFile:function(e){var t=this,a=f.default.queryString("appId",window.location.href),l={appId:a,tagId:e};m.default.post(c.default.createTagUserFile,l,function(){var a;t.setState((a={},n(a,"status"+e,1),n(a,"refresh",!1),a))})},componentDidMount:function(){var e=f.default.queryString("appId",window.location.href),t={appId:e,index:this.props.current};this.props.getTableData(t)},refresh:function(e){var t,a=f.default.queryString("appId",window.location.href),l={appId:a,index:this.props.current},r=this.props.tagName;r&&(l.tagName=r),this.setState((t={},n(t,"status"+e,null),n(t,"refresh",!0),t)),this.props.getTableData(l)},getContent:function(e){var t=this;return i.default.createElement("div",null,i.default.createElement(o.Button,{type:"primary",className:"color_bg mr10",onClick:function(){return t.togglePopover(e)}},"取消"),i.default.createElement(o.Button,{onClick:function(){return t.delOk(e)}},"确定"))},delOk:function(e){var t=c.default.blackDelete,a=f.default.queryString("appId",window.location.href),l=this;m.default.post(t,{blackId:e.id,appId:a},function(){o.message.success("黑名单删除成功"),l.togglePopover(e),l.refreshTable()})},refreshTable:function(){var e=this.props.blackName,t=f.default.queryString("appId",window.location.href),a={index:this.props.current,appId:t};e&&(a.blackName=e),this.props.getTableData(a)},disabled:function(e,t){var a=f.default.queryString("appId",window.location.href),l=c.default.blackDisable,n=this,r={appId:a,disable:!e.disable,blackId:e.id};m.default.post(l,r,function(){var a=e.disable?"启用成功":"禁用成功";o.message.success(a),n.props.setTableDataDisable(t)})},togglePopover:function(e){var t=e.id;this.setState(n({},"visibleDel"+t,!this.state["visibleDel"+t]))},toggleModal:function(e){this.setState({record:e,visible:!this.state.visible})},getBlackAttachInfo:function(e){var t=this,a=c.default.getBlackAttachInfo;a=f.default.makeUrl(a,{appId:e.appId,blackId:e.id}),m.default.get(a,function(a){t.setState(a.value),t.toggleModal(e)})},changeRadio:function(e){this.setState({blackType:e.target.value})},changeCheckbox:function(e){this.setState({reload:e.target.checked})},handleCancel:function(){},handleOk:function(){var e=this,t=this.state.record,a=c.default.blackEdit,l={appId:t.appId,blackId:t.id},n=this.state.reload,r=this.state.blackType;n&&(l.reload=n),0===t.appId&&(l.blackType=r),a=f.default.makeUrl(a,l),m.default.get(a,function(){o.message.success("设置成功"),e.toggleModal(),e.refreshTable()})},render:function(){var e=f.default.queryString("appId",window.location.href),t=this,a=[{title:"应用名称",key:"0",width:140,dataIndex:"appName",className:"ta_l",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},e)}},{title:"包名",className:"ta_l",key:"1",width:170,dataIndex:"packageName",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},e)}},{title:"黑名单类型",className:"ta_l",key:"2",dataIndex:"blackSource",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},e)}},{title:"黑名单名称",className:"ta_l ",key:"3",width:220,dataIndex:"blackName",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},e)}},{title:"更新时间",className:"ta_l",key:"4",width:100,dataIndex:"lmodify",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},f.default.dateFormat("yyyy-MM-dd hh:mm:ss",new Date(e)))}},{title:"状态",className:"ta_l",key:"5",dataIndex:"status",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},e)}},{title:"数量",className:"ta_r",key:"6",dataIndex:"blackNum",render:function(e,t){var a=t.disable?"colord9":"";return i.default.createElement("span",{className:a},e)}},{title:"操作",className:"ta_c",key:"7",render:function(a,l,n){var r="/garcia/webjsp/push/black/download?appId="+e+"&blackId="+l.id;return i.default.createElement("div",null,"用户画像"===l.blackSource&&i.default.createElement("a",{href:"javascript:;",onClick:function(){return t.getBlackAttachInfo(l)}},"设置"),"用户画像"!==l.blackSource&&i.default.createElement("a",{href:r},"下载"),l.disable?i.default.createElement("a",{className:"pl10",href:"javascript:;",onClick:function(){return t.disabled(l,n)}},"启用"):i.default.createElement("a",{className:"pl10",href:"javascript:;",onClick:function(){return t.disabled(l,n)}},"禁用"),i.default.createElement(o.Popover,{placement:"bottom",visible:t.state["visibleDel"+l.id],content:t.getContent(l),title:"确定删除黑名单?",onVisibleChange:function(){return t.togglePopover(l)},trigger:"click"},i.default.createElement("a",{className:"pl10",href:"javascript:;"},"删除")))},dataIndex:""}];return i.default.createElement("div",null,i.default.createElement(o.Table,{className:"home_table",columns:a,loading:this.props.tableData.loading,dataSource:this.props.tableData.data,pagination:this.props.tableData.pagination}),this.state.visible&&i.default.createElement(o.Modal,{width:1e3,onCancel:this.toggleModal,onOk:this.handleOk,okText:"保存",cancelText:"取消",title:"设置黑名单",visible:!0},"0"===e&&i.default.createElement(g,r({},v,{className:"radio_btn",label:"应用范围"}),i.default.createElement(b,{onChange:this.changeRadio,value:this.state.blackType,size:"large",style:{marginRight:10}},i.default.createElement(h,{value:1},"全部应用"),i.default.createElement(h,{value:3},"魅族应用"))),i.default.createElement(g,r({},v,{label:"标签详情"}),i.default.createElement("div",{style:{padding:"3px 0"}},this.state.tagInfo)),i.default.createElement(g,r({},v,{label:"用户群重置"}),i.default.createElement("div",{style:{padding:"3px 0"}},i.default.createElement(o.Checkbox,{className:"fs14",onClick:this.changeCheckbox,value:this.state.reload},"重新拉取数据")))))}});e.exports=k},1384:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},r=a(600),s=l(r),i=a(783),o=a(777),d=l(o),c=a(785),u=l(c),f=a(776),p=l(f),m=i.Form.Item,h=i.Radio.Group,b={labelCol:{span:6},wrapperCol:{span:18}},g=s.default.createClass({displayName:"AddBlack",getInitialState:function(){return{radioValue:1,data:null,value:"",initText:"IMEI",searchStatus:!1}},handleCancel:function(){this.setState({visible:!1})},addUsergroup:function(){var e=d.default.queryString("appId",window.location.href),t={appId:e,from:"config_black"},a="/user/group/new",l=d.default.makeUrl(a,t);window.location.hash=l},handleOk:function(){var e=this,t=d.default.queryString("appId",window.location.href);this.props.form.validateFields(function(a,l){if(a)return console.log(a),void console.log("Errors in form!!!");var n=p.default.blackAdd;n=d.default.makeUrl(n,{blackName:l.blackName,blackFilePath:l.blackFilePath,appId:t||0}),u.default.get(n,function(){i.message.success("保存成功"),e.handleCancel();var a={appId:t,index:1};e.props.getTableData(a)})})},onChange:function(e){var t=e.target.value;this.setState({radioValue:t})},getAppInfo:function(){var e=this,t=d.default.queryString("appId",window.location.href);return"0"!==t&&t?void u.default.get(p.default.getAppInfo+"?appId="+t,function(a){var l=a.value.flymeAuth?"IMEI":"PushId";e.setState({initText:l,appId:t})}):void this.setState({appId:t,initText:"IMEI"})},componentWillReceiveProps:function(){var e=d.default.queryString("appId",window.location.href);if(this.state.appId&&e!==this.state.appId){if("0"===e||!e)return void this.setState({appId:e,initText:"IMEI"});this.getAppInfo()}},componentDidMount:function(){this.getAppInfo()},render:function(){var e=this,t=p.default.blackUpload,a=this.props.form.getFieldProps,l=d.default.queryString("appId",window.location.href);t=d.default.makeUrl(t,{appId:l});var r=50,o={name:"blackFile",data:{},accept:".txt",action:t,beforeUpload:function(t){e.setState({loading:!0});var a=t.type;if(t.size>1048576*r)return i.message.error("文件大小不能超过"+r+"M"),e.setState({loading:!1}),!1;var l="text/plain"===a;return l||(i.message.error("请上传txt格式的文件"),e.setState({loading:!1})),l},headers:{authorization:"authorization-text"},onChange:function(t){if("removed"===t.file.status)return e.setState({loading:!1}),void(t.fileList.length<1&&e.props.form.setFieldsValue({blackFilePath:void 0}));if("error"===t.file.status&&e.setState({loading:!1}),"done"===t.file.status)if(e.setState({loading:!1}),200==t.file.response.code){var a=t.file.response.value;t.fileList.length>1&&t.fileList.shift(),i.message.success(t.file.name+" 上传成功。"),e.props.form.setFieldsValue({blackFilePath:a.blackFilePath}),e.setState({visible:!0,blackNum:a.blackNum,appName:a.appName})}else t.fileList.pop(),i.message.error(t.file.response.message),e.setState({visible:!1})}};return s.default.createElement(i.Form,{className:"add_black"},s.default.createElement("div",{className:"sub_toolbar config_toolbar"},s.default.createElement(i.Row,null,s.default.createElement(i.Col,{span:"14"},s.default.createElement("div",{className:"title"},s.default.createElement("span",{className:"border"}),"新建黑名单",s.default.createElement("span",{className:"fs12 pl10 color999"}))))),s.default.createElement(i.Row,{className:"mt15"},s.default.createElement(i.Col,{span:"8"},s.default.createElement(m,n({},b,{label:"黑名单类型"}),s.default.createElement(h,{value:this.state.radioValue,onChange:this.onChange},s.default.createElement(i.Radio,{name:"usergroup",value:1},this.state.initText),s.default.createElement(i.Radio,{name:"usergroup",value:2},"用户群"))))),s.default.createElement(i.Row,{className:"mt15"},s.default.createElement(i.Col,{span:"8"},1===this.state.radioValue?s.default.createElement(m,n({},b,{label:" "}),s.default.createElement(i.Upload,n({},a("blackFilePath"),{style:{width:200}},o),s.default.createElement(i.Button,{disabled:!!this.state.loading,size:"large",className:"btn_normal_show ",type:"ghost"},"TXT文档批量导入",this.state.loading?s.default.createElement(i.Icon,{type:"loading"}):s.default.createElement("span",null))),s.default.createElement("span",{className:"upload_tips"},"最多不超过50M，UTF-8无BOM格式编码文件，内容以回车键进行分割")):s.default.createElement(m,n({},b,{label:" "}),s.default.createElement(i.Button,{size:"large",onClick:this.addUsergroup,className:"btn_normal_show ",type:"ghost"},"添加群组"),s.default.createElement("span",{className:"upload_tips"},"添加用户群后，推送平台会每天更新此用户群最新数据作为黑名单")))),this.state.visible&&s.default.createElement(i.Modal,{width:1e3,onCancel:this.handleCancel,onOk:this.handleOk,okText:"保存",cancelText:"取消",title:"添加黑名单",visible:!0},s.default.createElement(m,n({},b,{label:"黑名单名称"}),s.default.createElement(i.Input,n({style:{width:200}},a("blackName",{validate:[{rules:[{required:!0,message:"请输入黑名单名称"},{max:30,message:"黑名单不能超过30个字"}],trigger:["onBlur","onChange"]}]})))),s.default.createElement(m,n({},b,{label:"应用名称"}),s.default.createElement("div",{style:{padding:"3px 0"}},this.state.appName)),s.default.createElement(m,n({},b,{label:"设备数"}),s.default.createElement("div",{style:{padding:"3px 0"}},this.state.blackNum))))}});g=i.Form.create()(g),e.exports=g}});