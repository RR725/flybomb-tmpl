webpackJsonp([39],{898:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=a(600),r=s(i),l=a(783),n=r.default.createClass({displayName:"Info",getContainer:function(){return document.getElementById("detailTable")},render:function(){var e=this,t=[{text:"短信内容",title:"单条短信长度为70字，超过70字后，按67字/条分隔成多条计费"},{text:"短信推送手机号白名单",title:"开启白名单后，短信推送的手机号推送功能目标用户将不过滤应用订阅关系"},{text:"目标数",title:"计划推送的目标数"},{text:"sms有效数",title:"从目标数中筛选订阅状态等其他信息后剩下的有效目标数"},{text:"发送数",title:"发送的短信量"},{text:"成功数",title:"运营商回馈成功发送完成的数量"},{text:"计费条数",title:"按短信字数，统计全部短信的具体计费条数"},{text:"日增用户数",title:"当天首次订阅应用的设备数"},{text:"在线峰值用户数",title:"订阅该应用的设备中，当天同时在线的数量峰值"},{text:"日联网用户数",title:"订阅该应用的设备中，当天有联网行为的设备数总和"},{text:"累计注册用户数",title:"历史累积订阅该应用的设备数，已卸载应用不计入累计用户数中"},{text:"联网数",title:"联网并且与通道形成长链接的设备数"},{text:"到达应用数",title:"PushSDK将消息发送给应用的数量（Flyme6中，通知栏消息由pushSDK弹出，此埋点仍保留有上报数据）"},{text:"划掉数",title:"在通知栏中划掉消息的数量。透传消息不统计该项"},{text:"已卸载数",title:"本次推送任务中应用已被卸载的数量，数据上将出现接收数大于展示数。（Flyme6固件此应用会被反订阅，在重新订阅前下次推送任务将不朝它推送；Flyme6以下固件应用没有被反订阅）"},{text:"有效数",title:"从目标数中去除错误或无效的ID，实际有效的ID数量。筛选包括开关状态，订阅状态，pushId有效性以及其他可以推送状态"},{text:"推送数",title:"Push平台实际下发推送的数量"},{text:"接收数",title:"Push服务接收数，任务有效期内，联网并正常接收到推送消息的数量"},{text:"展示数",title:"客户端从Push服务收到消息，并在通知栏中展示的数量（3.0以下版本SDK，数据统计T+1，3.0以上实时统计。透传消息没有展示数统计）"},{text:"点击数",title:"用户点击消息的数量（3.0以下版本SDK，数据统计T+1，3.0以上实时统计。透传消息没有点击数统计）"},{text:"收纳数",title:"通知栏消息被收进收纳盒的数量。（覆盖2017年5月份后发布的Flyme6固件用户）"},{text:"不展示数",title:"用户设置“不允许通知”的数量，消息不会展示在通知栏上。（覆盖2017年5月份后发布的Flyme6固件用户）"},{text:"App ID",title:"应用的唯一标识，客户端订阅推送时使用"},{text:"App Key",title:"客户端身份标识，客户端订阅推送时使用"},{text:"App Secret",title:"服务端身份标识，服务端 SDK 初始化使用"},{text:"点击动作",title:"调起包名不是必填项，如不填，则参数传给本应用"},{text:"推送黑名单",title:"选择黑名单后，本次推送将不会朝这批用户推送"},{text:"通知聚合",title:"通知分类用来控制多条通知在通知栏内的替换关系。同类通知之间新的替换旧的，不同类通知之间并存而不替换。最多可以有10000类通知并存。默认不填则多条通知可以并存。（此功能需要pushSDK版本更新至V3.5.0以上）"},{text:"定速推送",title:"开启定速推送后，此任务的推送速率将按设置的速率推送。速率不会超过应用最大推送速率"},{text:"定时展示",title:"开启定时展示后，目标用户的展示量将平摊到时间段内"},{text:"任务定制",title:"设置好循环推送的周期后，会在规定的时间点进行推送"},{text:"回执地址",title:"回执地址设置第三方接收消息回执的Http接口, 最大长度128字节，用于获取推送明细，Token用于回执接口鉴权"},{text:"标题",title:"标题的内容会展示在应用图标下方，具体展示效果请预推测试"},{text:"小图标",title:"小图标会出现在标题前面，占用部分的展示面积。可选择默认的图标类型，也可自定义上传，自定义图标的大小为24*24"},{text:"推送量",title:"周期内的推送总量，包括通知栏推送与透传推送"},{text:"消息收纳率",title:"计算公式：收纳数/（展示数-不展示数）"},{text:"消息划掉率",title:"计算公式：划掉数/（展示数-不展示数）"},{text:"推送有效率",title:"计算公式：有效数/目标数"},{text:"消息接收率",title:"计算公式：接收数/推送数"},{text:"功能转化率",title:"统计个性化推送、图片推送的转化率。衡量高级推送功能与普通常规推送的对比。计算公式：点击数/（展示数-不展示数）"},{text:"点击转化率",title:"周期内的点击率，仅统计通知栏推送方式的点击数据，计算公式：点击数/（展示数-不展示数），仅统计推送数大于1万的数据"},{text:"消息去重",title:"分组推送内的消息去重可能会出现子任务的推送用户量少于目标用户量的情况"},{text:"每天推送限制",title:"本应用一天可创建的taskId总量，仅包含平台创建，不包含API"},{text:"透传总量限制",title:"本应用一天可推送的透传消息总量，包含平台与API"},{text:"允许推送其他包名",title:"开启后，允许本应用带上第三方应用包名，点击通知栏后调起第三方应用"},{text:"总Task创建数量限制（次/天）",title:"本应用API可以创建的非调度taskId总量"},{text:"应用推送消息总量（条/天）",title:"本应用可推送的消息总量，包含通知栏、透传、平台任务，API接口调用等所有方式"},{text:"绿色通道",title:"开启绿色通道后，本应用的推送将不会被收进收纳盒内"},{text:"任务备注",title:"任务备注用于标记推送任务的业务类型与备注信息，方便后续推送数据的整理归类"}],a=t.map(function(t){var a=e.props.type,s=e.props.text;return s=a?a+s:s,0===s.indexOf(t.text)?t.title:""});return r.default.createElement("span",{className:"info_wrap"},r.default.createElement(l.Tooltip,{getTooltipContainer:this.getContainer,title:a},r.default.createElement("i",{className:"fs14 color999 fw_n cursor_p anticon anticon-info-circle-o"})),this.props.text)}});e.exports=n},900:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),p=a(777),u=s(p),d=o.Button.Group,c=o.Radio.Group,h=o.Form.Item,m=new Date,f={labelCol:{span:4},wrapperCol:{span:17}};window._cronWeeks=[1];var g=n.default.createClass({displayName:"ValidateTime",getInitialState:function(){return{cronWeek:[1],cronWeek1:!1}},onChange:function(e){this.props.onChangePushTime(e)},selectCronWeek:function(e){var t=this.state.cronWeek;if(1===t.length&&t[0]===e)return void o.message.error("推送周期不能为空");var a=t.filter(function(t){return t!==e});a.length===t.length?t.push(e):t=a,t.sort(),window._cronWeeks=t,this.setState(i({cronWeek:t},"cronWeek"+e,!this.state["cronWeek"+e])),this.props.selectCronWeek(t)},componentWillUnmount:function(){this.props.jumpUserGroup||(window._cronWeeks=[1])},selectCronTime:function(){},componentDidMount:function(){var e=u.default.queryString("pushType",window.location.href);if("timing"===e){var t=window._cronWeeks;this.props.selectCronWeek&&this.props.selectCronWeek(t);var a=new Date,s={dateNow:a,cronWeek:t};t.map(function(e){s["cronWeek"+e]=!0}),this.setState(s)}},onSelect:function(){},render:function(){var e=this,t=window.location.href,a=t.split("#"),s=u.default.queryString("pushType",a[1]),i=function(e){return e&&e.getTime()+864e5<=Date.now()},l=["一","二","三","四","五","六","日"],p=l.map(function(t,a){var s=a+1;return n.default.createElement(o.Button,{key:a,onClick:function(){return e.selectCronWeek(s)},type:e.state["cronWeek"+s]?"primary":""},t)}),g=this.state.dateNow,y="timing"===s?n.default.createElement(h,r({},f,{label:"任务定制    "}),n.default.createElement(h,r({className:"timing_push radio_btn time_push_checkbox"},this.props.formItemLayout,{label:"推送周期    "}),n.default.createElement(d,null,p)),n.default.createElement(h,r({style:{paddingTop:10},className:"timing_push"},this.props.formItemLayout,{label:"推送时间    "}),n.default.createElement(o.TimePicker,r({},this.props.getFieldProps("cronTime",{initialValue:g,onChange:this.selectCronTime,validate:[{rules:[{required:!0,type:"date",message:"请选择时间"}],trigger:["onBlur","onChange"]}]}),{placeholder:"选择时间",size:"large"})))):n.default.createElement(h,r({},this.props.formItemLayout,{label:"推送时间    "}),n.default.createElement(c,r({onChange:this.onChange},this.props.getFieldProps("pushTimeType",{initialValue:this.props.pushTimeType,onChange:this.props.changeRadio})),n.default.createElement(o.Radio,{name:"pushTimeType",value:0},"即时"),n.default.createElement(o.Radio,{name:"pushTimeType",value:1},"定时")),1===this.props.pushTimeType?n.default.createElement(h,{className:"display_ib mg0"},n.default.createElement(o.DatePicker,r({disabledDate:i},this.props.getFieldProps("startTime",{initialValue:m,onChange:this.onChange,validate:[{rules:[{required:!0,type:"date",message:"请输入推送时间"},{validator:function(e,t,a){var s=+new Date,i=+new Date(t);t&&s-i>0?a("推送时间不能早于当前时间"):a()}}],trigger:["onBlur","onChange"]}]}),{showTime:!0,format:"yyyy-MM-dd HH:mm:ss"}))):null);return y}});g=o.Form.create()(g),e.exports=g},902:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),p=a(776),u=s(p),d=a(777),c=s(d),h=a(785),m=s(h),f=o.Radio.Group,g=o.Form.Item,y={},v={},T=n.default.createClass({displayName:"UserType",getInitialState:function(){return{userTypeGroup:[],userTypeTags:[],tags:{},tagIds:{},visible:!1}},componentWillMount:function(){var e=location.href;e.indexOf("pushType=group")>-1&&(y={})},componentWillReceiveProps:function(){var e=this,t=c.default.queryString("appId",window.location.href),a=this.props.flymeAuth;if(this.props.appId&&t!==this.props.appId){this.getTags(t),this.getUserGroup(t);var s=this.props.userType;1!==s&&3!==s&&6!==s||!a||e.changeRadio({target:{name:"userType",value:2}})}},getTags:function(e){var t=this,a=u.default.appTag,s=this.props.tableDataIndex;a=c.default.makeUrl(a,{appId:e}),m.default.get(a,function(e){var a=e.value,i=a.length,r={},l={},n={};if(s){for(var o=s.userTypeInfo.tagIds||"",p=o.split(","),u=[],d=0;d<i;d++)for(var c=0;c<p.length;c++)a[d].tagId==p[c]&&(u.push(a[d].tagName),l[a[d].tagId]=!l[a[d].tagId],n[a[d].tagName]=!n[a[d].tagName]);u=u.join(","),r.tagIdsName=u,r.tagIdsValue=o}t.setState({userTypeTags:e.value,tags:n,tagIds:l,tagIdsName:r.tagIdsName||null,tagIdsValue:r.tagIdsValue||null}),t.props.form.setFieldsValue({tagIdsName:r.tagIdsName||null,tagIds:r.tagIdsValue||null})})},componentDidMount:function(){var e=c.default.queryString("appId",window.location.href),t=c.default.queryString("deal",window.location.href),a=c.default.queryString("groupId",window.location.href);if(this.setState({appId:e,pushType:c.default.queryString("pushType",window.location.href)}),(t||a||this.props.personalPush)&&this.getUserGroup(e),this.getTags(e),y={},v={},this.props.tableDataIndex)return void this.getUserGroup(e);var s=this.props.flymeAuth,i=void 0;s&&(i=6),(t||a)&&(i=1),i&&this.changeRadio({target:{name:"userType",value:i}})},getUserGroup:function(e){var t=this,a=u.default.listUserGroup;a=c.default.makeUrl(a,{appId:e}),m.default.get(a,function(e){t.setState({userTypeGroup:e.value.items,isDmp:e.value.isDmp,loadGroup:!0}),t.props.setUserTypeGroup(e.value)})},selectTags:function(e){var t=this.state.tags,a=this.state.tagIds,s=e.target.getAttribute("value"),i=e.target.getAttribute("title");t[i]=!t[i],a[s]=!a[s];var r=[],l=[];for(var n in t)t[n]&&r.push(n);for(var o in a)a[o]&&l.push(o);e.target.className=""===e.target.className?"current":"",this.setState({tags:t,tagIds:a,tagIdsName:r.join(","),tagIdsValue:l.join(",")}),this.props.form.setFieldsValue({tagIdsName:r.join(","),tagIds:l.join(",")}),this.props.changeRadio({target:{name:"tags"}})},delUserGroup:function(e,t){var a=this;this.setState({visible:!0,userGroupName:e,delIcon:!0,userGroupId:t});var s=a.props.form.getFieldValue("userGroupId");s!=t&&setTimeout(function(){a.props.form.setFieldsValue({userGroupId:s})},0)},delOk:function(){var e=this,t=c.default.queryString("appId",window.location.href),a=this,s=u.default.delUserGroup,i=this.state.userGroupId,r=this.props.form.getFieldValue("userGroupId");m.default.post(s,{id:this.state.userGroupId},function(){a.getUserGroup(t),o.message.success("用户群"+e.state.userGroupName+"删除成功"),a.props.clearUserGroup(r,i),a.setState({visible:!1,delIcon:!1})})},changeRadio:function(e){var t=c.default.queryString("appId",window.location.href),a=e.target.name,s=e.target.value;"userType"===a&&(this.setState(i({},"target"+s,this.props.form.getFieldValue("target"+s))),1===s&&this.getUserGroup(t)),this.props.changeRadio(e)},delCancel:function(){this.setState({visible:!1,delIcon:!1})},validate:function(e){var t=this,a=this.props.userType,s=this.props.tableDataIndex,i=null;return this.state["removed"+a]||this.props.userType!==(s&&s.userTypeInfo.userType)||(i=s.userFileName),this.props.getFieldProps(e,{onChange:function(){t.props.changeRadio({target:{name:"changeTarget"}})},initialValue:y["target"+a]||i,validate:[{rules:[{required:(a>1&&a<5||6===a||7===a)&&!this.state["targetRequired"+a],message:"不能为空"},{validator:function(e,t,a){t&&t.match(/^\s/)&&a(new Error("行首不能输入空格")),a()}}],trigger:["onBlur","onChange"]}],onBlur:function(e){y["target"+a]=e.target.value}})},getUserType:function(){var e=this,t=this.props.userType,a=u.default.uploadUserFile,s=c.default.queryString("appId",window.location.href);a=c.default.makeUrl(a,{pushType:"notice"===this.props.type?0:1,userType:t,appId:s});var l=10;e.props.flymeAuth&&(l=50);var p=[],d=this.props.tableDataIndex,h=y["target"+t];!h&&d&&t==d.userTypeInfo.userType&&(h=d.userFileName);var m=!1;!this.state["removed"+t]&&(!this.props.clearUserFile||this.state.clearUserFile)&&h&&h.indexOf(".txt")>-1&&h.indexOf(".txt")===h.length-4&&(p=[{uid:-1,name:h,status:"done",url:""}],m=!0);var f={name:"userFile",data:{},accept:".txt",action:a,defaultFileList:p,beforeUpload:function(t){e.setState({loading:!0});var a=t.type;if(t.size>1048576*l)return o.message.error("文件大小不能超过"+l+"M"),e.setState({loading:!1}),!1;var s="text/plain"===a;return s||(o.message.error("请上传txt格式的文件"),e.setState({loading:!1})),s},headers:{authorization:"authorization-text"},onChange:function(t){var a=e.props.userType;if("removed"===t.file.status){if(e.setState({loading:!1}),t.fileList.length<1){var s,r;e.setState((s={},i(s,"targetDisabled"+a,!1),i(s,"removed"+a,!0),i(s,"targetRequired"+a,!1),s)),e.props.form.setFieldsValue((r={},i(r,"userFilePath"+a,void 0),i(r,"target"+a,void 0),r)),y["target"+a]=null}return void e.props.changeRadio({target:{name:"remove"}})}if("error"===t.file.status&&e.setState({loading:!1}),"done"===t.file.status)if(e.setState({loading:!1}),200==t.file.response.code){var l,n;t.fileList.length>1&&t.fileList.shift(),o.message.success(t.file.name+" 上传成功。"),e.props.form.setFieldsValue((l={},i(l,"userFilePath"+a,t.file.response.value.userFilePath),i(l,"target"+a,t.file.name),l)),v["userFilePath"+a]=t.file.response.value.userFilePath,y["target"+a]=t.file.name,e.setState((n={},i(n,"targetDisabled"+a,!0),i(n,"clearUserFile",!0),i(n,"targetRequired"+a,!0),n)),"group"===e.state.pushType&&e.props.changeRadio({target:{name:"upload"}})}else t.fileList.pop(),o.message.error(t.file.response.message),e.props.form.setFieldsValue({})}};return n.default.createElement("div",{className:"user_type"},n.default.createElement(g,null,n.default.createElement(o.Input,r({disabled:m||this.state["targetDisabled"+t],style:{width:300},placeholder:"多个以;分隔",className:"mb10"},this.validate("target"+t)))),n.default.createElement(o.Upload,r({},this.props.getFieldProps("userFilePath"+t,{initialValue:v["userFilePath"+t]}),{style:{width:200}},f),n.default.createElement(o.Button,{disabled:!!this.state.loading,size:"large",className:"btn_normal_show ",type:"ghost"},"TXT文档批量导入",this.state.loading?n.default.createElement(o.Icon,{type:"loading"}):n.default.createElement("span",null))),n.default.createElement("span",{className:"upload_tips"},"最多不超过",l,"M，UTF-8无BOM格式编码文件，内容以回车键进行分割"))},handleSubmit:function(e,t){this.props.handleSubmit(e,"deal"),window.location.hash=t},changeUserGroupRadio:function(e){this.state.delIcon||this.props.changeRadio(e,"userGroupAuth")},getContainer:function(){return document.getElementById("userGropuList")},render:function(){var e=this,t={display:"block",height:30,position:"relative",lineHeight:1.5},a=c.default.queryString("appId",window.location.href),s=c.default.queryString("timingPushType",window.location.href),i="/user/group/new",l=this.state.userTypeGroup.map(function(r,l){var p=r.permission,u=r.id,d=r.name,h={appId:a,id:u,pushType:e.state.pushType};s&&(h.timingPushType=s);var m=c.default.makeUrl(i,h),f={display:"inline-block"};return f.color=p?"#666":"#f00",n.default.createElement(o.Radio,{permission:p,expression:r.userGroupDesc,label:d,key:l,style:t,name:"userGroupId",value:String(u)},n.default.createElement("div",{style:f},!p&&n.default.createElement(o.Tooltip,{getTooltipContainer:e.getContainer,title:"该用户群有标签无权限"},n.default.createElement("i",{className:"fs14  fw_n cursor_p anticon anticon-info-circle-o permission_info"})),n.default.createElement("span",{className:"ellipsis",style:{width:450,display:"inline-block",verticalAlign:"top"},title:d},d)),n.default.createElement("div",{style:{textAlign:"right",position:"absolute",right:"-10px",display:"inline-block"}},n.default.createElement(o.Tooltip,{title:"编辑用户群"},n.default.createElement("i",{onClick:e.handleSubmit.bind(e,window.event,m),className:"i_edit"})),n.default.createElement(o.Tooltip,{title:"删除用户群"},n.default.createElement("i",{onClick:e.delUserGroup.bind(e,d,u),className:"i_del"}))))}),p=this.state.userTypeTags.map(function(t,a){return n.default.createElement("li",{title:t.tagName,className:e.state.tagIds[t.tagId]?"current":"",value:t.tagId,onClick:e.selectTags,key:a},c.default.getTextOverFlow(t.tagName,10,!0))}),u=e.state.pushType,d={appId:a,currentId:this.props.form.getFieldValue("userGroupId"),pushType:u},h=this.props.groupPush;h&&(d.groupPush=h),s&&(d.timingPushType=s);var m=c.default.makeUrl(i,d),y=this.state.tagIdsName,v=this.state.tagIdsValue,T=this.props.userType,I=c.default.queryString("id",window.location.href)||c.default.queryString("groupId",window.location.href),b=this.props.smsPush;return n.default.createElement(g,r({},this.props.formItemLayout,{label:"指定用户    "}),n.default.createElement(f,this.props.getFieldProps("userType",{initialValue:T,onChange:this.changeRadio}),"group"===u?null:n.default.createElement(o.Radio,{name:"userType",value:0},"全部用户"),n.default.createElement(o.Radio,{name:"userType",value:1},"用户群"),this.props.personalPush||b?null:n.default.createElement(o.Radio,{name:"userType",value:2},n.default.createElement("span",null,"PushId")),b&&n.default.createElement(o.Radio,{name:"userType",value:7},n.default.createElement("span",null,"手机号")),this.props.personalPush||b?null:this.props.flymeAuth?n.default.createElement(o.Radio,{name:"userType",value:6},"IMEI"):null,this.props.personalPush||b||"group"===u?null:this.props.flymeAuth?n.default.createElement(o.Radio,{name:"userType",value:3},"Flyme账户"):null,this.props.personalPush||b?null:n.default.createElement(o.Radio,{name:"userType",value:4},"别名"),this.props.personalPush||b?null:n.default.createElement(o.Radio,{name:"userType",value:5},"标签")),1===T?n.default.createElement("div",{className:"user_type",id:"userGropuList"},l.length>0?n.default.createElement(g,null,n.default.createElement(f,r({value:this.props.form.getFieldValue("userGroupId"),className:"mb10",style:{width:"100%"}},this.props.getFieldProps("userGroupId",{initialValue:I,onChange:this.changeUserGroupRadio,validate:[{rules:[{required:!0,message:"请选择用户群"},{validator:function(e,t,a){"null"!==t&&"undefined"!==t||a(new Error("请选择用户群")),a()}}]}]})),l)):this.state.loadGroup?n.default.createElement("div",{className:"color_error"},"无用户群"):n.default.createElement("div",null,"数据拉取中..."),n.default.createElement(o.Button,{onClick:this.handleSubmit.bind(this,window.event,m),className:"color_bdc  ",type:"ghost",size:"large"},"添加群组")):null,2===T?this.getUserType():null,3===T?this.getUserType():null,4===T?this.getUserType():null,6===T?this.getUserType():null,7===T?this.getUserType():null,5===T?n.default.createElement("div",{className:"user_type",style:{width:600}},p.length>0?n.default.createElement("div",null,n.default.createElement(f,r({style:{width:"100%"}},this.props.getFieldProps("scope",{initialValue:this.props.scope,onChange:this.props.changeRadio})),n.default.createElement(o.Radio,{name:"scope",value:0},"并集"),n.default.createElement(o.Radio,{name:"scope",value:1},"交集")),n.default.createElement(g,null,n.default.createElement(o.Input,r({style:{width:300},disabled:!0,title:this.props.form.getFieldValue("tagIdsName"),placeholder:"选择标签"},this.props.getFieldProps("tagIdsName",{initialValue:y,rules:[{required:!0,message:"请选择标签"}]})))),n.default.createElement("div",{style:{display:"none "}},n.default.createElement(g,null,n.default.createElement(o.Input,r({hidden:!0,style:{width:300},placeholder:"选择标签"},this.props.getFieldProps("tagIds",{initialValue:v}))))),n.default.createElement("ul",{className:"tag_list"},p)):n.default.createElement("div",{className:"color_error"},"无标签")):null,n.default.createElement(o.Modal,{title:"系统提示",visible:e.state.visible,onOk:e.delOk,onCancel:e.delCancel},n.default.createElement("p",null,"删除用户群：",e.state.userGroupName,"?")))}});e.exports=T},903:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l=a(600),n=s(l),o=a(783),p=a(898),u=s(p),d=a(777),c=s(d),h=o.Radio.Group,m=o.Form.Item,f=n.default.createClass({displayName:"AdvanceSetting",getInitialState:function(){return{display:"none",selectBlack:[],errorTips:"",startTimeStatus:"success",endTimeStatus:"success",noticeImgUrl:this.props.noticeImgUrl}},showAdvance:function(){this.props.showAdvance()},checkBoxChange:function(e){var t=e.target.checked,a=e.target.value;this.props.form.setFieldsValue(i({},a,t?1:0)),this.props.changeRadio(e)},changeStart:function(e){this.props.form.setFieldsValue({fixStartDisplayTime:e})},changeEnd:function(e){this.props.form.setFieldsValue({fixEndDisplayTime:e})},validateStartTime:function(e){var t=this,a=this.props.tableDataIndex;return this.props.getFieldProps(e,{initialValue:a&&a.advanceInfo.fixStartDisplayTime?new Date(a.advanceInfo.fixStartDisplayTime):this.props.form.getFieldValue("startTime")||new Date,onChange:function(e){var a=+new Date(e),s=t.props.form.getFieldValue("fixEndDisplayTime"),i="none",r="",l="success",n="success";a&&s&&a>s&&(r="结束时间不能早于开始时间",l="error",n="error",i=""),a||(r="请选择开始时间",i="",l="error"),s||(r="请选择结束时间",i="",n="error"),t.setState({startTimeStatus:l,endTimeStatus:n,display:i,errorTips:r})}})},validateEndTime:function(e){var t=this,a=this.props.tableDataIndex;return this.props.getFieldProps(e,{initialValue:a&&a.advanceInfo.fixEndDisplayTime?new Date(a.advanceInfo.fixEndDisplayTime):this.props.form.getFieldValue("startTime")||new Date,onChange:function(e){var a=+new Date(e),s=t.props.form.getFieldValue("fixStartDisplayTime"),i="none",r="",l="success",n="success";s&&a&&a<s&&(r="结束时间不能早于开始时间",l="error",n="error",i=""),s||(r="请选择开始时间",i="",l="error"),a||(r="请选择结束时间",i="",n="error"),t.setState({startTimeStatus:l,endTimeStatus:n,display:i,errorTips:r})}})},validateNotifyKey:function(e){return this.props.getFieldProps(e,{validate:[{rules:[{validator:function(e,t,a){t&&!String(t).match(/^[1-9]+[0-9]*$/)||Number(t)>1e4?a(new Error("请输入1-10000之间的整数")):a()}}],trigger:["onBlur","onChange"]}]})},validateFixSpeedRate:function(e){var t=this,a=t.props.limitRate;return this.props.getFieldProps(e,{validate:[{rules:[{validator:function(e,t,s){t?t&&!String(t).match(/^[1-9]+[0-9]*$/)?s(new Error("请输入正整数")):t&&t>a?s(new Error("推送速率被设置为不能大于"+a)):s():s(new Error("请输入推送速率"))}}],trigger:["onBlur","onChange"]}]})},componentDidMount:function(){var e=this.props.tableDataIndex,t=[];e&&(t=e.advanceInfo.blackId,t=t.split(","),this.setState({selectBlack:t}))},changeBlack:function(e,t){var a=this,s=e.target.checked,i=this.state.selectBlack;s?i.push(e.target.name):i=i.filter(function(t){return t!==e.target.name});var r=this.props.blackList;r.map(function(l,n){if(a.props.form.getFieldValue("blackId"+l.blackId)&&s){var o=i.filter(function(e){return e===l.blackId});o.length||i.push(""+l.blackId)}n===t&&(r[n].choose=e.target.checked)}),this.props.changeBlack(r,t),this.setState({selectBlack:i})},changeRadioBlack:function(e){var t=this.state.selectBlack,a=void 0;1!==t.length||t[0]||(a="black"),this.props.changeRadio(e,a)},render:function(){var e=this,t=this.props.blackList,a=this.state.selectBlack,s=c.default.queryString("pushType",window.location.href),i=t.map(function(t,s){var i=t.choose;if(a.length){i=!1;for(var l=0;l<a.length;l++){var p=a[l];p===String(t.blackId)&&(i=!0)}}return n.default.createElement(m,{className:"mg0",key:s},n.default.createElement("label",null,n.default.createElement(o.Checkbox,r({data:t,name:String(t.blackId),title:t.blackName,checked:i},e.props.getFieldProps("blackId"+t.blackId,{initialValue:i,onChange:function(t){e.changeBlack(t,s)}}))),t.blackName,n.default.createElement("span",{title:t.title,className:"pl10"},"数量：",t.blackNum)))});t.length||(i=n.default.createElement("span",{className:"color_error "},"无黑名单"));var l=this.props.vibrate,p=this.props.sound,d=this.props.lights,f=function(t){var a=e.props.form.getFieldValue("startTime"),s=Date.now();return a&&(s=a),t&&t.getTime()+864e5<=s};return n.default.createElement("div",null,!this.props.personalPush&&n.default.createElement(m,r({className:"border_top advance_toggle"},this.props.formItemLayout,{label:"高级设置   "}),n.default.createElement(o.Icon,{onClick:this.showAdvance,style:{fontSize:12,paddingTop:13},type:this.props.showAdvanceStatus?"cross":"down"})),n.default.createElement("div",{style:{display:this.props.showAdvanceStatus?"":"none"}},!this.props.personalPush&&n.default.createElement(m,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(u.default,{text:"定速推送　"})}),n.default.createElement(h,this.props.getFieldProps("fixSpeed",{initialValue:this.props.fixSpeed,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"fixSpeed",value:0},"关闭"),n.default.createElement(o.Radio,{name:"fixSpeed",value:1},"开启")),1===this.props.fixSpeed||this.props.form.getFieldValue("fixSpeed")?n.default.createElement(m,{className:"fix_speed_rate"},n.default.createElement(o.Input,r({style:{width:100}},this.validateFixSpeedRate("fixSpeedRate"))),n.default.createElement("span",{className:"pl10"},"条/秒")):null),this.props.personalPush||"desktop"===s||"notice"!==this.props.type?null:n.default.createElement("div",null,"timing"!==s&&n.default.createElement(m,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(u.default,{text:"通知聚合　"})}),n.default.createElement(o.Input,r({style:{width:100}},this.validateNotifyKey("notifyKey")))),"timing"!==s&&n.default.createElement(m,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(u.default,{text:"定时展示　"})}),n.default.createElement(h,this.props.getFieldProps("fixDisplay",{initialValue:this.props.fixDisplay,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"fixDisplay",value:0},"关闭"),n.default.createElement(o.Radio,{name:"fixDisplay",value:1},"开启")),1===this.props.fixDisplay?n.default.createElement("div",null,n.default.createElement(m,{validateStatus:this.state.startTimeStatus,className:"display_ib va_t mg0"},n.default.createElement(o.DatePicker,r({disabledDate:f,onOk:this.changeStart,showTime:!0},this.validateStartTime("fixStartDisplayTime"),{placeholder:"开始时间",format:"yyyy-MM-dd HH:mm:ss"}))),n.default.createElement("span",{className:"pl10 pr10"},"至"),n.default.createElement(m,{validateStatus:this.state.endTimeStatus,className:"display_ib va_t mg0"},n.default.createElement(o.DatePicker,r({disabledDate:f},this.validateEndTime("fixEndDisplayTime"),{placeholder:"结束时间",onOk:this.changeEnd,showTime:!0,format:"yyyy-MM-dd HH:mm:ss"}))),n.default.createElement("span",{style:{display:this.state.display},className:"color_error pl10"},this.state.errorTips)):null),this.props.msgCacheStatus?n.default.createElement(m,r({},this.props.formItemLayout,{label:"消息缓存    "}),n.default.createElement(h,this.props.getFieldProps("msgCache",{initialValue:this.props.msgCache,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"msgCache",value:0},"关闭"),n.default.createElement(o.Radio,{name:"msgCache",value:1},"开启"))):null,n.default.createElement(m,r({},this.props.formItemLayout,{label:"通知栏悬浮窗    "}),n.default.createElement(h,this.props.getFieldProps("suspend",{initialValue:this.props.suspend,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"suspend",value:1},"显示"),n.default.createElement(o.Radio,{name:"suspend",value:0},"不显示"))),n.default.createElement(m,r({},this.props.formItemLayout,{label:"清除通知栏    "}),n.default.createElement(h,this.props.getFieldProps("clearNoticeBar",{initialValue:this.props.clearNoticeBar,onChange:this.props.changeRadio}),n.default.createElement(o.Radio,{name:"clearNoticeBar",value:1},"可清除"),n.default.createElement(o.Radio,{name:"clearNoticeBar",value:0},"不可清除"))),n.default.createElement(m,r({},this.props.formItemLayout,{label:"通知提醒类型    "}),n.default.createElement("label",{className:"mr10"},n.default.createElement(o.Checkbox,r({className:"mr10"},this.props.getFieldProps("vibrate",{value:l}),{value:"vibrate",onChange:this.checkBoxChange,checked:!!l})),"震动"),n.default.createElement("label",{className:"mr10"},n.default.createElement(o.Checkbox,r({className:"mr10"},this.props.getFieldProps("lights",{value:d}),{value:"lights",onChange:this.checkBoxChange,checked:!!d})),"闪灯"),n.default.createElement("label",null,n.default.createElement(o.Checkbox,r({className:"mr10"},this.props.getFieldProps("sound",{value:p}),{value:"sound",onChange:this.checkBoxChange,checked:!!p})),"声音"))),"sms"!==s&&n.default.createElement(m,r({className:"black_notice"},this.props.formItemLayout,{label:n.default.createElement(u.default,{text:"推送黑名单　　"})}),n.default.createElement(h,this.props.getFieldProps("black",{initialValue:this.props.black,onChange:this.changeRadioBlack}),n.default.createElement(o.Radio,{name:"black",value:1},"使用"),n.default.createElement(o.Radio,{name:"black",value:0},"禁用"))),1===this.props.form.getFieldValue("black")&&n.default.createElement("div",{className:"user_type user_type_black"},i,n.default.createElement("span",{className:"color_error",style:{display:this.props.displayBlackList}},"请选择黑名单"))))}});e.exports=f},904:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=a(600),l=s(r),n=a(783),o=a(777),p=s(o),u=a(905),d=s(u),c=a(906),h=s(c),m={labelCol:{span:6},wrapperCol:{span:18}},f=l.default.createClass({displayName:"PushModal",getInitialState:function(){return{popoverVisible:!1}},componentDidMount:function(){document.querySelector("#prepush")&&(document.querySelector("#prepush").classList="prepush_position")},render:function(){var e=this.props.form.getFieldValue("startTime"),t=window.location.href,a=p.default.queryString("pushType",t),s=this.props.form.getFieldValue("noticeExpandType"),r="　";0===s&&(r="标准"),1===s&&(r=l.default.createElement("div",null,"文本",l.default.createElement("div",{className:"break_word lh15 mt5 mb5 pr40"},this.props.noticeExpandContent))),2===s&&(r=l.default.createElement("div",null,"大图",l.default.createElement("div",{className:"break_word lh15 mt5 mb5 pr40"},l.default.createElement("img",{width:"225",height:"144",src:window.bigImageFilePathJson&&window.bigImageFilePathJson.noticeExpandImgUrl||this.props.form.getFieldValue("noticeExpandImgUrl")})))),3===s&&(r="ACT文件");var o=this.props.form.getFieldValue("clickType"),u="　";0===o&&(u="打开应用"),1===o&&(u="打开应用页面"),2===o&&(u="打开URI页面"),3===o&&(u="应用客户端自定义");var c=this.props.form.getFieldValue("clickPackage"),f=this.props.form.getFieldValue("userType");2===f&&this.props.personalPush&&(f=6);var g="　";if(0===f&&(g="全部用户"),1===f){g="用户群";var y=this.props.userGroupName;y&&(g+="("+y+")")}2===f&&(g="PushId"),3===f&&(g="Flyme账户"),4===f&&(g="别名"),5===f&&(g="标签"),6===f&&(g="IMEI"),7===f&&(g="手机号");var v="　",T=[],I="";if(this.props.requestData){var b=this.props.requestData.advanceInfo.notificationType,E=this.props.requestData.clickTypeInfo,S={},w=[];for(var k in b)b[k]&&("vibrate"===k&&w.push("震动"),"lights"===k&&w.push("闪灯"),"sound"===k&&w.push("声音"));if(v=w.join("+"),0===w.length&&(v="无"),E){if(S=E.parameters,1==o||2==o||3==o){var x=E.activity||E.url||E.customAttribute||"";1===o&&(x="页面地址："+x),T.push(l.default.createElement("div",{className:"break_word",key:x},x))}if(2!=o&&3!=o)for(var F in S)"undefined"!=F&&""!=F&&T.push(l.default.createElement("div",{key:F},l.default.createElement("p",null,"参数：",F.trim()),l.default.createElement("p",{className:"break_word"},"值：",String(S[F]).trim())))}I=document.getElementById("userName").innerHTML}var P=[];this.props.distinctTitle&&(P=this.props.distinctTitle.map(function(e,t){return l.default.createElement("div",{key:t},e)}));var D=this.props.form.getFieldValue("fixStartDisplayTime"),N=this.props.form.getFieldValue("fixEndDisplayTime");D=D?p.default.dateFormat("yyyy-MM-dd hh:mm:ss",D):null,N=N?p.default.dateFormat("yyyy-MM-dd hh:mm:ss",N):null;var C=N&&D?D+" 至 "+N:"",V="notice"===this.props.type?"推送通知":"透传消息";"desktop"===a&&(V="桌面通知"),"sms"===a&&(V="短信通知");var R=this.props.listSceneTag,U=this.props.cronWeek,G=this.props.form.getFieldValue("cronTime");G&&"object"===("undefined"==typeof G?"undefined":i(G))&&(G=p.default.dateFormat("hh:mm:ss",G));
var _={formItemLayout:m,appName:this.props.appName,noticeBarType:this.props.form.getFieldValue("noticeBarType"),noticeBarImgUrl:window.smallImageFilePathJson&&window.smallImageFilePathJson.noticeBarImgUrl||this.props.form.getFieldValue("noticeBarImgUrl"),title:this.props.form.getFieldValue("title"),content:this.props.form.getFieldValue("content")+(this.props.checkedTD?"回复【TD】退订":""),smsType:"1"===this.props.form.getFieldValue("smsType")?"营销短信":"普通短信",remark:this.props.form.getFieldValue("remark"),noticeExpandTypeText:r,clickTypeText:u,clickPackage:c,startTime:e,offLine:this.props.form.getFieldValue("offLine"),validTime:this.props.form.getFieldValue("validTime"),userTypeText:g,listSceneTag:R,algoTypeName:this.props.algoTypeName,distinct:this.props.form.getFieldValue("distinct"),fixSpeed:this.props.form.getFieldValue("fixSpeed"),fixSpeedRate:this.props.form.getFieldValue("fixSpeedRate"),notifyKey:this.props.form.getFieldValue("notifyKey"),fixDisplay:this.props.form.getFieldValue("fixDisplay"),fixDisplayTime:C,msgCache:this.props.form.getFieldValue("msgCache"),msgCacheStatus:this.props.msgCacheStatus,suspend:this.props.form.getFieldValue("suspend"),clearNoticeBar:this.props.form.getFieldValue("clearNoticeBar"),notificationTypeText:v,noticeImgUrl:this.props.noticeImgUrl,pushType:"notice"===this.props.type?0:1,clickTypeInfoText:T,userName:I,articleLength:this.props.form.getFieldValue("articleLength"),freshnessNew:this.props.form.getFieldValue("freshnessNew"),distinctTitle:P,tagIdsName:this.props.form.getFieldValue("tagIdsName"),userGroupDesc:1===f?this.props.userGroupDesc:null,scopeDesc:0==this.props.form.getFieldValue("scope")?"并集":"交集",black:this.props.form.getFieldValue("black"),blackList:this.props.blackList,cronTime:G,cronWeek:U,listMaterial:this.props.listMaterial,pushPercent:this.props.pushPercent,iconType:this.props.form.getFieldValue("iconType"),icon:this.props.form.getFieldValue("icon"),iconUrl:this.props.form.getFieldValue("iconUrl")},L=l.default.createElement(h.default,{smsPush:this.props.smsPush,submiting:this.props.submiting,handleOk:this.props.handleOk,type:this.props.type,personalPush:this.props.personalPush,requestData:this.props.requestData,handleCancel:this.props.handleCancel,visible:this.props.visible,pushReviewNumber:this.props.pushReviewNumber,popoverVisible:this.state.popoverVisible});return l.default.createElement(n.Modal,{footer:L,width:700,onCancel:this.props.handleCancel,title:V,visible:this.props.visible},l.default.createElement(d.default,{pushDetailData:_,personalPush:this.props.personalPush}))}});e.exports=f},906:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=a(600),l=s(r),n=a(783),o=a(776),p=s(o),u=a(777),d=s(u),c=a(785),h=s(c),m=l.default.createClass({displayName:"Distinct",getInitialState:function(){var e=window.location.href,t=e.split("#"),a=d.default.queryString("pushType",t[1]);return{pushType:a,values:null,popoverVisible:!1}},handleSave:function(){var e=this.state.pushType,t=this;if(this.props.visible)return"timing"===e?void this.props.handleOk():void this.props.handleSubmit(null,"group",function(e){t.props.setTableData(e)})},handleVisibleChange:function(e){if(this.props.batch&&!this.props.groups.length)return n.message.error("请选择推送内容进行预推");var t=this;this.props.groupPush?this.props.handleSubmit(null,"group",function(a){var s=t.props.addPushData;a.pushTimeInfo=s.pushTimeInfo,a.userTypeInfo=s.userTypeInfo,t.setState({values:a,popoverVisible:e})}):t.setState({popoverVisible:e})},pushReview:function(){var e=this,t=d.default.queryString("appId",window.location.href),a=this.state.pushType,s=this.props.batch,i=document.querySelector("#pushId"+this.props.type).value,r=this.props.requestData,l=this.props.smsPush,o="notice"===this.props.type?0:1;i=i.replace(/^\s+/,"").replace(/\s+$/,"");var u=p.default.pushReview;if(s){var c=this.props.groups,m=c.length;r.map(function(e){e.pushId=i});var f=[];if(r.map(function(e){for(var t=0;t<m;t++)e.id==c[t]&&f.push(e)}),r=f,u=p.default.batchPushReview,!r.length)return n.message.error("请选择推送内容进行预推")}else l?(r.pushReviewPhone=i,u=p.default.pushReviewSms):r.pushId=i;if(!i)return n.message.error("请输入PushId");var g={};1!==o||l||(g={appId:t,pushId:r.pushId,title:r.title,content:r.content,pushTimeInfo:{offLine:r.pushTimeInfo.offLine,validTime:r.pushTimeInfo.validTime}},r=g),"desktop"===a&&(o=3);var y={pushType:o,appId:t,json:JSON.stringify(r)};h.default.post(u,y,function(t){s?e.props.batchError(t):n.message.success("预推成功")})},render:function(){var e,t,a,s=this.state.pushType,r=this.props.smsPush,o=r?"输入手机号（预推计入费用清单）":"输入PushId",p=l.default.createElement("div",null,l.default.createElement(n.Row,{style:{height:36,lineHeight:"33px"}},l.default.createElement(n.Col,{className:" fs16",span:"5"},"预推测试"),l.default.createElement(n.Col,{span:"14"},l.default.createElement(n.Input,{style:{width:235},id:"pushId"+this.props.type,placeholder:o})),l.default.createElement(n.Col,{span:"5"},l.default.createElement(n.Button,{className:"w_80",type:"primary",onClick:this.pushReview,size:"large"},"预推")))),u=this.props.batch;return l.default.createElement("div",{style:{textAlign:"center"},className:u?"fr":""},this.props.groupPush||this.props.personalPush||u?null:l.default.createElement("p",{key:"p",className:"push_review_num"},"预计推送人数",l.default.createElement("span",{className:"num"},this.props.pushReviewNumber)),this.props.personalPush?null:l.default.createElement(n.Popover,(e={overlayClassName:u?"":"prepush_position",key:"popover",placement:u?"bottomRight":"topRight"},i(e,"key","test"),i(e,"content",p),i(e,"trigger","click"),i(e,"visible",this.state.popoverVisible),i(e,"onVisibleChange",this.handleVisibleChange),e),l.default.createElement(n.Button,{type:"ghost",className:"color_bdc",size:"large"},"预推测试")),u?null:this.props.groupPush||"timing"===s?l.default.createElement(n.Button,(t={key:"button"},i(t,"key","submit"),i(t,"type","primary"),i(t,"size","large"),i(t,"style",{marginLeft:8}),i(t,"onClick",this.handleSave),t),"保存",this.props.submiting?l.default.createElement(n.Icon,{type:"loading"}):l.default.createElement("span",null)):l.default.createElement(n.Button,(a={key:"button"},i(a,"key","submit"),i(a,"type","primary"),i(a,"size","large"),i(a,"style",{marginLeft:8}),i(a,"onClick",this.props.handleOk),a),"推送",this.props.submiting?l.default.createElement(n.Icon,{type:"loading"}):l.default.createElement("span",null)))}});e.exports=m},1732:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=a(600),o=s(n),p=a(783),u=a(799),d=s(u),c=a(898),h=s(c),m=a(776),f=s(m),g=a(785),y=s(g),v=a(777),T=s(v),I=a(900),b=s(I),E=a(902),S=s(E),w=a(903),k=s(w),x=a(904),F=s(x),P=a(906),D=s(P),N=a(800),C=s(N),V=p.Form.Item,R=null,U=null;window.vedioFilePathJson={},window.smallImageFilePathJson={},window.bigImageFilePathJson={},window.iconImageFilePathJson={};var G=C.default.createActions(["notice"]),_=C.default.createStore({listenables:[G],jsonData:null}),L={labelCol:{span:4},wrapperCol:{span:20}},q="回复TD退订",B=o.default.createClass({displayName:"AddAppTask",getInitialState:function(){return{checkedTD:!0,smsLen:1,smsWordLen:6,offLine:1,cronWeek:[1],onlyWifi:1,vibrate:1,lights:1,sound:1,displayDistinct:"none",displayBlackList:"none",iconImageDisplay:"none",smallImageDisplay:"none",vedioDisplay:"none",bigImageDisplay:"none",iconType:1,icon:"push_icon1",noticeExpandType:0,clickType:0,scope:0,userType:0,distinct:0,fixSpeed:0,msgCache:0,blackList:[],netType:0,fixDisplay:0,suspend:1,startTimeStatus:"success",endTimeStatus:"success",pushTimeStatus:"success",popoverVisible:!1,clearNoticeBar:1,smalllayerDisplay:"none",biglayerDisplay:"none",visible:!1,pushReviewNumber:"...",toggleStatus:!1,showAdvanceStatus:!1,pushTimeType:0,distinctTitle:[]}},delParams:function(e,t){for(var a in t)delete e[a]},clickTypeParams:function(e,t){this.setState(i({},"clickTypeParams"+t,e))},handleOk:function(){var e=this,t=T.default.queryString("appId",window.location.href),a={appId:t,json:JSON.stringify(this.state.requestData)},s=this.state.pushReviewNumber;if("0"===s)return void p.message.error("预计推送人数为0，不可以创建推送任务");if(!this.state.submiting){this.setState({submiting:!0});var i=f.default.addSms,r="/sms/push/record?appId="+t;y.default.post(i,a,function(){p.message.success("提交成功"),window.location.hash=r},function(){e.setState({submiting:!1})},{timeout:6e4})}},showAdvance:function(){this.setState({showAdvanceStatus:!this.state.showAdvanceStatus})},selectCronWeek:function(e){this.setState({cronWeek:e})},onChangeIcon:function(e){this.setState({icon:e})},handleSubmit:function(e,a,s){var i=this,r=this;"deal"===a&&this.setState({jumpUserGroup:!0});var n=window.location.href,o=n.split("#"),u=T.default.queryString("pushType",o[1]);return this.state.permission===!1&&"deal"!==a&&1===this.props.form.getFieldValue("userType")&&this.props.form.getFieldValue("userGroupId")?void p.message.error("用户群标签没权限"):void this.props.form.validateFields(function(e,n){var o=n.userType;if(!(+new Date(n.fixStartDisplayTime)>+new Date(n.fixEndDisplayTime))){if("deal"===a)return n.showAdvanceStatus=r.state.showAdvanceStatus,n.distinctTitle=r.state.distinctTitle,_.jsonData=n,void(t.jsonData=n);if((5!==o||n.tagIds)&&(1!==o||n.userGroupId&&"null"!==n.userGroupId)){if(2!==n.iconType||window.iconImageFilePathJson.iconUrl||n.iconUrl||r.state.iconUrl||r.props.form.getFieldValue("iconUrl")||(i.setState({iconImageDisplay:""}),e={}),2!==n.noticeExpandType||window.bigImageFilePathJson.noticeExpandImgUrl||n.noticeExpandImgUrl||r.state.noticeExpandImgUrl||r.props.form.getFieldValue("noticeExpandImgUrl")||(i.setState({bigImageDisplay:""}),e={}),3!==n.noticeExpandType||window.vedioFilePathJson.vedioUrl||r.props.form.getFieldValue("vedioUrl")||(i.setState({vedioDisplay:""}),e={}),n.target=n["target"+o],n.userFilePath=n["userFilePath"+o],delete n["userFilePath"+o],""===n.target&&delete n.target,n.userFilePath&&delete n.target,e)return console.log(e),void console.log("Errors in form!!!");var p=n.content.trim()+(r.state.checkedTD?q:"");if(n.content=p,"timing"===u){var d=n.cronTime;"object"===("undefined"==typeof d?"undefined":l(d))&&(d=T.default.dateFormat("hh:mm:ss",d));var c=i.state.cronWeek;n.cronTimeInfo={time:d,week:c.join(",")},delete n.cronTime,r.delParams(n,n.cronTimeInfo)}var h="App";1===n.clickType&&(h="AppPage");var m=[];for(var g in n)if(g.indexOf("key"+h)>-1){var v=g.split("key"+h)[1];m.push(v)}n.pushTimeInfo={pushTimeType:n.pushTimeType,startTime:n.startTime&&T.default.dateFormat("yyyy-MM-dd hh:mm:ss",n.startTime),offLine:n.offLine,validTime:n.validTime},r.delParams(n,n.pushTimeInfo),n.groupPushScope=n.scope,n.userGroupName=r.state.userGroupName,n.userTypeInfo={userType:o,userGroupId:n.userGroupId,target:n.target,tagIds:n.tagIds,scope:n.scope,userFilePath:n.userFilePath},r.delParams(n,n.userTypeInfo),n.advanceInfo={fixSpeed:n.fixSpeed,fixSpeedRate:n.fixSpeedRate},r.delParams(n,n.advanceInfo);var I="notice"===r.props.pushType?0:1,b=T.default.queryString("appId",window.location.href);n.appId=b,r.setState({requestData:n,visible:"group"!==a});var E={appId:b,userTypeInfo:n.userTypeInfo},S=f.default.getPushCount;S=T.default.makeUrl(S,{appId:b,pushType:I,json:JSON.stringify(E)}),r.setState({pushReviewNumber:"..."}),"group"!==a&&y.default.get(S,function(e){r.setState({pushReviewNumber:e.value})},null,{timeout:3e5}),s&&"function"==typeof s&&s(n)}}})},validateRemark:function(e){var t=this.props.form.getFieldProps,a=100;return t(e,{validate:[{rules:[{required:!1},{max:a,message:"任务备注不能超过"+a+"个字"},{validator:function(e,t,a){t&&t.match(/^\s/)&&a(new Error("行首不能输入空格")),a()}}],trigger:["onBlur","onChange"]}]})},onChangeTD:function(e){var t=e.target.checked,a=this.state.smsWordLen,s=a+(t?6:-6),i=T.default.getSmsCount(s);this.setState({checkedTD:t,smsWordLen:s,smsLen:i})},validateContent:function(e){var t=this,a=this.props.form.getFieldProps,s="短信内容";return a(e,{onChange:function(e){var a=t.state.checkedTD?6:0,s=e.target.value,i=s.length+a,r=T.default.getSmsCount(i);t.setState({smsWordLen:i,smsLen:r})},validate:[{rules:[{required:!0,message:"请输入"+s},{validator:function(e,t,a){t&&t.match(/^\s/)&&a(new Error("行首不能输入空格")),a()}}],trigger:["onBlur","onChange"]}]})},queryMobileValidImei:function(){var e=this.props.form.getFieldValue("checkImeiPath"),t=this.props.form.getFieldValue("versionNum"),a="?checkImeiPath="+e+"&versionNum="+t;y.default.get(f.default.queryMobileValidImei+a,function(e){var t=e.value;p.message.success("有效IMEI数"+t)})},componentWillMount:function(){var e=this,t=T.default.queryString("appId",window.location.href);t&&e.props.form.setFieldsValue({appId:t})},cantNull:function(e){var t=this.props.form.getFieldProps;return t(e,{rules:[{required:!0,message:"不能为空"}]})},clearUserGroup:function(e,t){if(e==t){var a={};a.userGroupName=null,a.userGroupDesc=null,U=null,R=null,this.setState(a),this.props.form.setFieldsValue({userGroupId:null})}},changeRadio:function(e,t){var a={};"userGroupAuth"===t&&(a.permission=e.target.permission);var s=e.target.name,i=e.target.value;if(a[s]=i,"userGroupId"===s&&(a.userGroupName=e.target.label,a.userGroupDesc=e.target.expression,U=e.target.label,R=e.target.expression),"vibrate"===i||"sound"===i||"lights"===i){var r=e.target.checked;a[i]=r?1:0}this.setState(a),this.props.form.setFieldsValue(a),this.showButton(s,i)},showButton:function(e,t){"noticeExpandType"===e&&1!==t&&this.setState({noticeExpandContent:!1}),"noticeExpandType"===e&&2===t&&this.setState({toggleStatus:!0,showBigImg:!0,biglayerDisplay:"none"}),"noticeExpandType"===e&&1===t&&this.setState({toggleStatus:!1,biglayerDisplay:"none"})},handleCancel:function(){this.setState({visible:!1,submiting:!1})},getAppName:function(e){var t="全部应用",a=d.default.allApp;if(a)for(var s=0;s<a.length;s++)a[s].appId==e&&(t=a[s].name);this.setState({appName:t})},componentWillReceiveProps:function(){var e=T.default.queryString("appId",window.location.href);this.state.appId&&e!==this.state.appId&&(this.getAppName(e),this.setState({pushReviewNumber:"...",appId:e}),this.getAppInfo())},getAppInfo:function(e){var t=this,a=T.default.queryString("appId",window.location.href);y.default.get(f.default.getAppInfo+"?appId="+a,function(a){var s=a.value.appIconUrl;e&&e(s),e||(t.setState({noticeImgUrl:""===s?null:s}),t.props.form.setFieldsValue({noticeImgUrl:""===s?null:s})),t.setState({loadAppInfo:!0,flymeAuth:a.value.flymeAuth,appName:a.value.appName,limitRate:a.value.limitRate,msgCacheStatus:a.value.msgCache,pushOtherPackage:a.value.pushOtherPackage})})},setUserTypeGroup:function(e){e=e.items;for(var t=e.length,a=T.default.queryString("id",window.location.href),s=0;s<t;s++)a==e[s].id&&(this.setState({userGroupName:e[s].name}),U=e[s].name,R=e[s].userGroupDesc)},fillFormData:function(e){var t=this,a=e.value,s=a.noticeBarInfo&&a.noticeBarInfo.content||a.content,i=s.indexOf(q)>-1,r=new RegExp("("+q+")","g"),l=s.replace(r,""),n=l.length||0,o=3===a.smsType?T.default.queryString("smsType",window.location.href):a.smsType+"",p={remark:a.remark,content:l,smsType:o,fixSpeed:a.fixSpeed?1:0,fixSpeedRate:a.fixSpeedRate,offLine:a.pushTimeInfo&&a.pushTimeInfo.offLine?1:0,validTime:a.pushTimeInfo&&a.pushTimeInfo.validTime,iconType:a.launcherInfo&&a.launcherInfo.iconType,icon:a.launcherInfo&&a.launcherInfo.icon,iconUrl:a.launcherInfo&&a.launcherInfo.iconUrl},u=this.props.tableDataIndex;if(u&&a.userTypeInfo){var d=a.userTypeInfo.userType;p.userType=d,p.userGroupId=a.userTypeInfo.userGroupId,p["target"+d]=a.userTypeInfo.target||a.userFileName,p.tagIds=a.userTypeInfo.tagIds,p.scope=a.userTypeInfo.scope,p["userFilePath"+d]=a.userTypeInfo.userFilePath}t.props.form.setFieldsValue(p);var c=n+(i?6:0),h=T.default.getSmsCount(c);t.setState({checkedTD:i,smsWordLen:c,smsLen:h,offLine:a.pushTimeInfo&&a.pushTimeInfo.offLine?1:0}),t.showAdvance()},componentDidMount:function(){var e=this,t=T.default.queryString("appId",window.location.href);this.setState({appId:t});var a=T.default.queryString("deal",window.location.href),s=T.default.queryString("groupId",window.location.href),i=T.default.queryString("id",window.location.href);if(a&&_.jsonData&&!this.props.addPush?(this.setState({userType:1,userGroupId:i}),_.jsonData.userType=1,_.jsonData.userGroupId=i,e.setState(_.jsonData),e.props.form.setFieldsValue(_.jsonData)):(R=null,U=null,window.vedioFilePathJson={},window.smallImageFilePathJson={},window.bigImageFilePathJson={},window.iconImageFilePathJson={},window._smallIconValue=null,e.props.form.setFieldsValue(this.state)),s){var r={userType:1,userGroupId:s};this.setState(r),e.props.form.setFieldsValue(r)}this.getAppInfo(function(a){e.props.form.setFieldsValue({noticeImgUrl:a});var s=T.default.queryString("taskId",window.location.href),i=T.default.queryString("pushType",window.location.href);if(s){var r="sms"===i?f.default.copyTaskSms:f.default.pushTaskCopy;r=T.default.makeUrl(r,{taskId:s,appId:t}),y.default.get(r,function(t){e.fillFormData(t)})}});var l=this.props.tableDataIndex;l&&this.fillFormData({value:l})},clickHide:function(e){1===e&&this.setState({noticeExpandContent:!1,toggleStatus:!1}),2===e&&this.setState({noticeExpandImgUrl:!1,showBigImg:!1,toggleStatus:!1})},clickShow:function(e){if(1===e){var t=this.props.form.getFieldValue("noticeExpandContent");if(!t)return void p.message.error("请输入展开文本");this.setState({noticeExpandContent:!0,toggleStatus:!0})}if(2===e){var a=this.props.form.getFieldValue("noticeExpandImgUrl");this.setState({noticeExpandImgUrl:a,showBigImg:!0,toggleStatus:!0})}},changeIcon:function(e){this.setState({noticeImgUrl:null}),this.props.form.setFieldsValue({noticeImgUrl:e})},onChangePushTime:function(e){var t=this.props.form.getFieldValue("fixEndDisplayTime"),a=this.props.form.getFieldValue("fixStartDisplayTime"),s=e>a?e:a,i=e>t?e:t;this.props.form.setFieldsValue({startTime:e,fixEndDisplayTime:i||e,fixStartDisplayTime:s||e})},render:function(){var e=this.props.form.getFieldProps,t=T.default.queryString("pushType",window.location.href),a="请输入短信内容",s=o.default.createElement(h.default,{text:"短信内容"}),i=o.default.createElement("span",null,s,"    ");return o.default.createElement(p.Form,{horizontal:!0,id:"detailTable"},o.default.createElement(p.Row,null,o.default.createElement(p.Col,{span:"24",className:"col_left"},o.default.createElement(V,r({},L,{label:"短信类型"}),o.default.createElement(p.Select,r({},e("smsType",{initialValue:"1"}),{style:{width:200}}),o.default.createElement(p.Select.Option,{value:"1"},"营销短信"),o.default.createElement(p.Select.Option,{value:"2"},"普通短信"))),"desktop"!==t&&o.default.createElement(V,r({},L,{label:o.default.createElement(h.default,{text:"任务备注　"})}),o.default.createElement(p.Input,r({rows:"3",type:"textarea",placeholder:"请输入任务备注",style:{width:500}},this.validateRemark("remark")))),o.default.createElement("div",{className:"pos_r sms_content"},o.default.createElement(V,r({},L,{label:i}),o.default.createElement(p.Input,r({rows:"9",placeholder:a,style:{resize:"none",width:500},type:"textarea"},this.validateContent("content")))),o.default.createElement(V,r({},L,{label:" "}),o.default.createElement(p.Checkbox,{checked:this.state.checkedTD,onChange:this.onChangeTD},"在短信内容结尾添加“",q,"”")),o.default.createElement("div",{className:"sms_position"},o.default.createElement("p",null,"字　数：",this.state.smsWordLen,"/70"),o.default.createElement("p",null,"短信数：",this.state.smsLen))),this.props.groupPush?null:o.default.createElement("div",null,o.default.createElement(b.default,{formItemLayout:L,getFieldProps:e,jumpUserGroup:this.state.jumpUserGroup,selectCronWeek:this.selectCronWeek,form:this.props.form,onChangePushTime:this.onChangePushTime,pushTimeStatus:this.state.endTimeStatus,pushTimeType:this.props.form.getFieldValue("pushTimeType"),changeRadio:this.changeRadio})),(this.props.groupType||!this.props.groupPush)&&this.state.loadAppInfo?o.default.createElement(S.default,{form:this.props.form,formItemLayout:L,getFieldProps:e,clearUserGroup:this.clearUserGroup,scope:this.state.scope,tableDataIndex:this.props.tableDataIndex,groupPush:!!this.props.groupType,userType:this.props.form.getFieldValue("userType"),handleSubmit:this.handleSubmit,userGroupId:this.state.userGroupId,type:this.props.pushType,smsPush:!0,setUserTypeGroup:this.setUserTypeGroup,flymeAuth:!1,appId:T.default.queryString("appId",window.location.href),changeRadio:this.changeRadio}):null,o.default.createElement(k.default,{form:this.props.form,formItemLayout:L,getFieldProps:e,appId:T.default.queryString("appId",window.location.href),fixSpeed:this.state.fixSpeed,blackList:this.state.blackList,black:this.state.black,msgCache:this.state.msgCache,displayBlackList:this.state.displayBlackList,msgCacheStatus:this.state.msgCacheStatus,startTimeStatus:this.state.startTimeStatus,tableDataIndex:this.props.tableDataIndex,endTimeStatus:this.state.endTimeStatus,limitRate:this.state.limitRate,fixDisplay:this.state.fixDisplay,netType:this.state.netType,suspend:this.state.suspend,showAdvanceStatus:this.state.showAdvanceStatus,showAdvance:this.showAdvance,clearNoticeBar:this.state.clearNoticeBar,vibrate:this.props.form.getFieldValue("vibrate"),lights:this.props.form.getFieldValue("lights"),changeIcon:this.changeIcon,sound:this.props.form.getFieldValue("sound"),noticeImgUrl:this.state.noticeImgUrl||this.props.form.getFieldValue("noticeImgUrl"),changeRadio:this.changeRadio,type:this.props.pushType}))),o.default.createElement(p.Row,{className:"push_btn"},o.default.createElement(p.Col,{span:"14"},this.props.groupPush?null:o.default.createElement(V,{label:""},o.default.createElement(p.Button,{type:"primary",onClick:this.handleSubmit,size:"large"},"推送")))),this.props.groupPush?o.default.createElement(p.Row,null,o.default.createElement(p.Col,null,o.default.createElement(D.default,{submiting:this.props.submiting,handleOk:this.props.handleOk,type:this.props.pushType,groupPush:this.props.groupPush,groupType:this.props.groupType,form:this.props.form,setTableData:this.props.setTableData,handleSubmit:this.handleSubmit,addPushData:this.props.addPushData,requestData:this.state.requestData,handleCancel:this.props.handleCancel,visible:this.props.visible,pushReviewNumber:this.state.pushReviewNumber,popoverVisible:this.state.popoverVisible}))):null,o.default.createElement(F.default,{form:this.props.form,requestData:this.state.requestData,noticeImgUrl:this.state.noticeImgUrl||this.props.form.getFieldValue("noticeImgUrl"),smsPush:!0,visible:this.state.visible,userGroupName:U||this.state.userGroupName,userGroupDesc:R||this.state.userGroupDesc,handleOk:this.handleOk,checkedTD:this.state.checkedTD,cronWeek:this.state.cronWeek,blackList:this.state.blackList,noticeExpandContent:window._noticeExpandContent,appName:this.state.appName,submiting:this.state.submiting,msgCache:this.state.msgCache,msgCacheStatus:this.state.msgCacheStatus,type:this.props.pushType,handleCancel:this.handleCancel,distinctTitle:this.state.distinctTitle,pushReviewNumber:this.state.pushReviewNumber}))}});B=p.Form.create()(B),e.exports=B}});