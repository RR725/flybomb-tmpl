webpackJsonp([26],{1397:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=a(600),r=n(l),o=a(1398),s=n(o),i=a(776),u=n(i),c=a(777),p=n(c),d=a(785),h=n(d),m=r.default.createClass({displayName:"App",getInitialState:function(){return{current:1,tableData:{loading:!0,data:[],pagination:null}}},tableData:function(e){var t=this;this.setState({tableData:{loading:!0}});var a=u.default.accountManaging;a=p.default.makeUrl(a,e),h.default.get(a,function(e){var a=e.value.result;a.map(function(e,t){a[t].key=t}),t.setState({tableData:{data:a,loading:!1,pagination:{total:e.value.amount,current:t.state.current,pageSize:10,showSizeChanger:!1,onChange:function(e){var a={index:e};t.setState({current:e}),t.tableData(a)}}}})})},componentDidMount:function(){var e={index:1};this.tableData(e)},render:function(){return r.default.createElement("div",null,r.default.createElement(s.default,{homeCurrent:this.state.current,current:this.state.current,refresh:this.state.refresh,tableDataList:this.state.tableData,onSearch:this.tableData}))}});e.exports=m},1398:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=a(600),r=n(l),o=a(783),s=a(776),i=n(s),u=a(785),c=n(u),p=a(777),d=n(p),h=a(799),m=n(h),f=a(1399),g=n(f),I=a(1400),v=n(I),b=a(1401),A=n(b),S=a(1403),E=n(S),D=r.default.createClass({displayName:"AddAppTask",getInitialState:function(){return{initData:{},current:1,searchCurrent:1,values:[],subAccountTitle:"全部子账号",authData:{appList:[]},tableData:{loading:!0,data:[],pagination:null},data:null,noticeBarType:"0",noticeExpandType:"0",pushTimeType:"0",appName:"全部应用",appId:0,errors:{},defaultAppid:"应用",randomUser:1}},handleSubmit:function(e){e.preventDefault(),this.props.form.validateFields(function(e,t){return e?void console.log("Errors in form!!!"):(t.noticeBarInfo={noticeBarType:t.noticeBarType,title:t.title,content:t.content,noticeBarImgUrl:t.noticeBarImgUrl},delete t.noticeBarType,delete t.title,delete t.content,delete t.noticeBarImgUrl,void c.default.post(i.default.addNotice,t,function(){o.message.success("提交成功")}))})},componentWillMount:function(){var e=this,t=d.default.queryString("id",window.location.href);t&&e.props.form.setFieldsValue({appId:t})},changeRadio:function(e){var t={};t[e.target.name]=e.target.value,this.setState(t)},textInput:function(){},selectType:function(e,t){this.props.form.setFieldsValue({appId:e}),this.setState({appId:e,appName:t});var a={index:1};e&&(a.appId=e),this.props.onSearch(a)},allSubAccount:function(){},createSubAccount:function(){},getAllSubAccountTable:function(e,t,a){var n=this,l=e.editData&&e.editData.appId,r=i.default.showSubAccount,o={index:a,pageSize:6};l&&(o.appId=l),r=d.default.makeUrl(r,o),c.default.get(r,function(l){for(var r=l.value.result,o=0;o<r.length;o++)r[o].key=o;n.setState(e),n.setState({tableData:{data:r,loading:!1,pagination:{total:l.value.amount,current:a,pageSize:6,showSizeChanger:!1,onChange:function(a){n.setState({current:a,searchCurrent:a}),e[t]=!0,n.getAllSubAccountTable(e,t,a)}}}})})},toggleModal:function(e,t){var a=this,n={};if(n[e]=!this.state[e],n.editData=t,"allSubAccount"!==e||this.state[e]||(n.searchCurrent=1,this.getAllSubAccountTable(n,e,1),t&&t.appId&&this.setState({subAccountTitle:"子账号"})),"createSubAccount"===e)if(this.state[e]){var l=this.state.appId,r={index:this.props.current};l&&(r.appId=l);var o={allSubAccount:!0,editData:{appId:t.appId}};t&&t.appId&&this.getAllSubAccountTable(o,"allSubAccount",1),this.props.onSearch(r)}else{var s=i.default.authorizePage,u={};t&&t.managerId&&(u.userId=t.managerId),t&&t.appId&&(u.appId=t.appId),s=d.default.makeUrl(s,u),c.default.get(s,function(e){for(var t=e.value,l=t.appList,r=t.authAppModuleVoList||[],o=0;o<l.length;o++)for(var s=0;s<r.length;s++)if(l[o].appId===r[s].appId){var i=l.splice(o,1);l.unshift(i[0])}t.appList=l,a.setState({authData:t}),a.setState(n)})}this.state[e]&&this.setState(n)},onSearchFlyme:function(e,t){var a=this;t&&0!=t||(t=1,this.setState({searchCurrent:t,current:t}));var n=i.default.subAccountSearching,l={accountName:e,index:t||this.state.searchCurrent,pageSize:6},r=this.state.editData;r&&r.appId&&(l.appId=r.appId),r.accountName=e,n=d.default.makeUrl(n,l),c.default.get(n,function(n){for(var l=n.value.result,o=0;o<l.length;o++)l[o].key=o;a.setState({editData:r,tableData:{data:l,loading:!1,pagination:{total:n.value.amount,current:t||a.state.searchCurrent,pageSize:6,showSizeChanger:!1,onChange:function(t){a.setState({searchCurrent:t,current:t}),a.onSearchFlyme(e,t)}}}})})},render:function(){var e=this,t={api:i.default.listMainApp,width:"190",all:"全部应用",appName:this.state.appName,name:"appId",appId:this.state.appId};return r.default.createElement("div",null,r.default.createElement(o.Form,{horizontal:!0},r.default.createElement(o.Row,{className:"home_toolbar"},r.default.createElement(o.Col,{span:"8"},r.default.createElement(m.default.render,{notFoundContent:"无数据",showSearch:!0,searchPlaceholder:"搜索应用名称",selectType:this.selectType,initData:t})),r.default.createElement(o.Col,{span:"9"}," "),r.default.createElement(o.Col,{span:"7",className:"ta_r"},r.default.createElement(o.Button,{type:"ghost",onClick:this.toggleModal.bind(this,"allSubAccount"),className:"btn_normal_show ",size:"large"},"全部子账号"),r.default.createElement(o.Button,{type:"primary",onClick:this.toggleModal.bind(this,"createSubAccount"),className:"btn_normal_show color_bg ml10",size:"large"},"创建子账号"))),this.state.allSubAccount&&r.default.createElement(o.Modal,{title:this.state.subAccountTitle,footer:null,visible:!0,onOk:this.delOk,onCancel:this.toggleModal.bind(this,"allSubAccount")},r.default.createElement("div",{className:"sub_account_search"},r.default.createElement("div",{className:"fr"},r.default.createElement(E.default,{onSearch:this.onSearchFlyme}))),r.default.createElement(g.default,{homeCurrent:this.props.homeCurrent,homeTable:this.props.onSearch,editData:this.state.editData,searchAppId:this.state.appId,current:this.state.current,searchCurrent:this.state.searchCurrent,onSearchFlyme:this.onSearchFlyme,type:"allSubAccount",getAllSubAccountTable:this.getAllSubAccountTable,authData:this.state.authData,toggleModal:this.toggleModal,self:e,refresh:this.state.refresh,tableData:this.state.tableData})),this.state.createSubAccount?r.default.createElement(v.default,{editData:this.state.editData,authData:this.state.authData,toggleModal:this.toggleModal,self:e,createSubAccount:this.state.createSubAccount}):null),r.default.createElement(A.default,{homeCurrent:this.props.homeCurrent,toggleModal:this.toggleModal,refresh:this.props.refresh,onSearch:this.props.onSearch,tableData:this.props.tableDataList}))}});D=o.Form.create()(D),e.exports=D},1399:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=a(600),o=n(r),s=a(783),i=a(776),u=n(i),c=a(785),p=n(c),d=o.default.createClass({displayName:"App",getContent:function(e,t){return o.default.createElement("div",null,o.default.createElement(s.Button,{type:"primary",className:"color_bg mr10",onClick:this.togglePopover.bind(this,e)},"取消"),o.default.createElement(s.Button,{onClick:this.delAccount.bind(this,e,t)},"确定"))},getInitialState:function(){var e=this;return{createSubAccount:!1,current:1,dataSource:null,pagination:null,columns:[{title:"子账号",key:"0",className:"ta_c",dataIndex:"managerName",render:function(e,t){return o.default.createElement("span",{className:t.isDel?"colord9":""},e)}},{title:"操作",key:"1",className:"ta_c",render:function(t,a,n){var l=a.isDel?"i_undisable":"i_disable",r=a.isDel?"启用":"禁用";return o.default.createElement("div",{className:"btn_wrap"},o.default.createElement(s.Tooltip,{title:"编辑"},o.default.createElement("i",{onClick:e.modifyAccount.bind(e,a.managerName,a.managerId,a.appId),className:"i_edit"})),o.default.createElement(s.Tooltip,{title:r},o.default.createElement("i",{onClick:e.disabledAccount.bind(e,a.managerId,a.isDel,n),className:l})),o.default.createElement(s.Tooltip,{title:"删除"},o.default.createElement(s.Popover,{placement:"bottom",visible:e.state["visible"+a.managerId],content:e.getContent(a.managerId,n),title:"确定删除该账号?",onVisibleChange:e.togglePopover.bind(e,a.managerId),trigger:"click"},o.default.createElement("i",{onClick:e.togglePopover.bind(e,a.managerId),className:"i_del"}))))}}],refresh:!1}},componentWillMount:function(){},togglePopover:function(e){this.setState(l({},"visible"+e,!this.state["visible"+e]))},modifyAccount:function(e,t,a){var n={managerName:e,managerId:t,appId:a};this.props.toggleModal("createSubAccount",n)},disabledAccount:function(e,t){var a=this,n=u.default.changeStatus,l={flymeAccountId:e,status:t?1:0},r=a.props.editData;r&&r.appId&&(l.appId=r.appId),p.default.post(n,l,function(){var e=a.props.type,t={};t[e]=!0,t.editData=r,r.accountName?a.props.onSearchFlyme(r.accountName,a.props.searchCurrent):a.props.getAllSubAccountTable(t,e,a.props.searchCurrent)})},delAccount:function(e){var t=u.default.delSubAccount,a=this,n={flymeAccountId:e},l=a.props.editData;l&&l.appId&&(n.appId=l.appId),p.default.post(t,n,function(){s.message.success("删除成功");var t=a.props.type,n={};n[t]=!0,n.editData=l,l.accountName?a.props.onSearchFlyme(l.accountName,a.props.searchCurrent):a.props.getAllSubAccountTable(n,t,a.props.searchCurrent);var r={index:a.props.homeCurrent},o=a.props.searchAppId;o&&(r.appId=o),a.props.homeTable(r),a.togglePopover(e)})},addAccount:function(){var e=this.props.editData;this.props.toggleModal("createSubAccount",{appId:e.appId})},render:function(){var e=this.props.editData,t=null;return e&&e.appId&&(t=o.default.createElement(s.Button,{style:{position:"relative",top:"-42px",zIndex:99},type:"primary",onClick:this.addAccount,className:" color_bg ml10"},"添加账号")),o.default.createElement("div",null,o.default.createElement(s.Table,{columns:this.state.columns,loading:this.props.tableData.loading,dataSource:this.state.dataSource||this.props.tableData.data,pagination:this.state.pagination||this.props.tableData.pagination}),t)}});e.exports=d},1400:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=a(600),s=n(o),i=a(783),u=a(776),c=n(u),p=a(777),d=n(p),h=a(785),m=n(h),f=a(799),g=n(f),I=i.Radio.Group,v=i.Radio.Button,b=i.Form.Item,A=i.Select.Option,S={labelCol:{span:5},wrapperCol:{span:19}},E=s.default.createClass({displayName:"App",getInitialState:function(){return{liClass:"",loading:!1,appName:"",currentData:[],jsonData:[],authData:[],authChecked:[],createSubAccount:this.props.createSubAccount}},componentWillMount:function(){var e=this.props.authData.appList;this.setState({appDefaultValue:e[0].appId+","+e[0].appName})},componentDidMount:function(){var e=this.props.authData.appList,t=this.props.authData.authAppModuleVoList||[],a=this.props.editData;if(a&&a.managerId){var n={};t.map(function(e){var t=e.moduleIdList,a=[];t.map(function(t){n["checkedauth"+String(e.appId)+t]=!0,a.push(t)}),n["authChecked"+e.appId]=a,n["checked"+e.appId]=!0}),n.appId=a.appId||e[0].appId,n.jsonData=t,this.setState(n),this.getAppInfo()}else{var l=e[0].appId;this.setState({appId:l,jsonData:[{appId:l,moduleIdList:[]}]});var r={target:{value:l+","+e[0].appName}};this.selectApp(r)}},getAppInfo:function(e){var t=e||this.state.appId;if(t){var a=this;m.default.get(c.default.getAppInfo+"?appId="+t,function(e){a.setState({insightAuth:e.value.insightAuth})})}},validate:function(e){var t=this.props.form.getFieldProps;return t(e,{validate:[{rules:[{required:!0,message:"请输入Flyme账号 "},{min:4,message:"Flyme账号不能少于4个字符"},{max:32,message:"Flyme账号不能超过32个字符"},{validator:function(e,t,a){t&&t.length>=4&&t.length<=32&&t.match(/^\s/)?a(new Error("行首不能输入空格")):a()}}],trigger:["onBlur","onChange"]}]})},createAccount:function(){var e=this;this.props.form.validateFields(function(t,a){var n=e.state.jsonData;if(t)return void console.log("Errors in form!!!");var l={flymeAccount:a.flymeAccount,json:JSON.stringify(n)},r=e.props.editData,o="新建成功";r.managerName&&(l.flymeAccount=r.managerName,l.flymeAccountId=r.managerId,o="编辑成功"),r.appId&&(l.appId=r.appId),m.default.post(c.default.addSubAccount,l,function(){i.message.success(o),e.props.toggleModal("createSubAccount",r)})})},selectApp:function(e,t){for(var a=e.target.value,n=a.split(","),l=Math.ceil(n[0]),r=n[1],o=t||this.state.jsonData,s=null,i=!1,u=0;u<o.length;u++)o[u].appId===l&&(i=!0,s=o[u]);for(var c=this.props.authData.appList,p=0;p<c.length;p++)c[p].appId===l&&(s={appId:l,moduleIdList:[]});i||o.push(s);var d={};d.jsonData=o,d.appId=l,d.appDefaultValue=l+","+r,this.setState(d);for(var h=void 0,m=0;m<o.length;m++)o[m].appId===s.appId&&(this.setState({appId:s.appId}),h=s.appId);this.getAppInfo(h)},changeManage:function(e,t){var a,n=this.state.jsonData,r=!this.state["checkedauth"+String(this.state.appId)+t.id],o=this.state.appId,s=this.state["authChecked"+o]||[];r?s.push(1):s.pop();for(var i=!1,u=0;u<n.length;u++)if(n[u].appId===o){for(var c=n[u].moduleIdList,p=0;p<c.length;p++)c[p]===t.id&&(i=!0,r||c.splice(p,1));i||c.push(t.id),n[u].moduleIdList=c}var d={};0===s.length?d["checked"+o]=!1:d["checked"+o]=!0,d.jsonData=n,this.setState((a={},l(a,"authChecked"+o,s),l(a,"checkedauth"+String(this.state.appId)+t.id,!this.state["checkedauth"+String(this.state.appId)+t.id]),a)),this.setState(d)},handleChange:function(e,t){t=t[0];var a=this;this.props.form.setFieldsValue({appId:e}),this.setState({appId:e,appName:t});for(var n=this.props.authData.appList,l=0;l<n.length;l++){var r=n[l];if(r.appId==e){a.setState({appList:[r],appDefaultValue:r.appId+","+r.appName});var o={target:{value:r.appId+","+r.appName}};a.selectApp(o);break}a.setState({appList:null})}},getAppName:function(e){for(var t=g.default.allApp,a=0;a<t.length;a++)if(t[a].appId===e)return t[a].name},render:function(){var e=this,t=this.props.editData,a="";a=t.managerName?"编辑子账号":"添加子账号";var n=this.state.appList||this.props.authData.appList,l=n.map(function(t,a){return s.default.createElement(v,{value:t.appId+","+t.appName,key:a},s.default.createElement("img",{src:t.appIconUrl||"/resources/push/images/default_icon.png",width:"60",height:"60"}),s.default.createElement("div",{title:t.appName},s.default.createElement("label",null,s.default.createElement(i.Checkbox,{disabled:!0,checked:e.state["checked"+t.appId]}),d.default.getTextOverFlow(t.appName,8,!0))))}),o=this.props.authData.defaultModuleTemplate,u=o,p=[];u.map(function(t,a){var n=t.childModuleList,l=null;n&&n.length>0&&(l=n.map(function(t,a){return s.default.createElement(i.Col,{span:"5",key:a},s.default.createElement("label",null,s.default.createElement(i.Checkbox,{checked:e.state["checkedauth"+String(e.state.appId)+t.id],onChange:function(a){return e.changeManage(a,t)}}),s.default.createElement("span",{title:t.name,className:"auth_checked_name"},t.name)))})),p.push(s.default.createElement(i.Row,{key:a},s.default.createElement(i.Col,{className:"color999",span:"4"},t.name),s.default.createElement(i.Col,{span:"20"},l)))});for(var h=[],m=0;m<n.length;m++)h.push(s.default.createElement(A,{key:n[m].appName},n[m].appName));var f=this.props.editData&&e.props.editData.appId,E={api:c.default.listMainApp,width:"300",all:"全部应用",title:"搜索",name:"appId"};return s.default.createElement(i.Modal,{zIndex:"1008",width:900,title:a,visible:this.props.createSubAccount,onOk:this.createAccount,onCancel:this.props.toggleModal.bind(this.props.self,"createSubAccount",{appId:f})},s.default.createElement(i.Form,{style:{paddingTop:20},horizontal:!0},s.default.createElement(i.Row,null,s.default.createElement(i.Col,{span:"24"},s.default.createElement(b,r({},S,{label:"Flyme账号    "}),t.managerName?s.default.createElement("span",null,t.managerName):s.default.createElement(i.Input,r({style:{width:300},placeholder:"4-32个字符"},this.validate("flymeAccount")))),s.default.createElement(b,r({},S,{label:"应用权限    "}),f?s.default.createElement("span",null,e.getAppName(f)):s.default.createElement("div",null,s.default.createElement(b,null,s.default.createElement(g.default.render,{notFoundContent:"无数据",showSearch:!0,searchPlaceholder:"搜索应用名称",selectType:this.handleChange,initData:E})),s.default.createElement("div",{className:"auth_applist"},s.default.createElement(I,{value:this.state.appDefaultValue,onChange:this.selectApp,size:"large"},l)))),s.default.createElement(b,r({},S,{label:"管理权限    "}),p)))))}});E=i.Form.create()(E),e.exports=E},1401:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=a(600),r=n(l),o=a(783),s=a(1402),i=n(s),u=r.default.createClass({displayName:"ManageTabel",getInitialState:function(){var e=this;return{showMainAccountModal:!1,columns:[{title:"应用名称",key:"0",dataIndex:"appName",className:"td_appname ",render:function(e,t){return r.default.createElement("div",null,r.default.createElement("img",{src:t.appIconUrl||"/resources/push/images/default_icon.png",width:"24",height:"24"}),e)}},{title:"主账号",key:"1",className:"ta_c",dataIndex:"mainAccountName",render:function(t,a){var n={name:t,appId:a.appId,mainAccountId:a.mainAccountId};return r.default.createElement("div",{onClick:e.toggleModal.bind(e,window.event,n)},r.default.createElement("a",{href:"javascript:;"},t))}},{title:"子账号",key:"2",className:"ta_c",dataIndex:"subAccountNum",render:function(t,a){return r.default.createElement("div",{onClick:e.showSubAccount.bind(e,window.event,a.appId)},r.default.createElement("a",{href:"javascript:;"},t))}}],refresh:!1}},toggleModal:function(e,t){var a={showMainAccountModal:!this.state.showMainAccountModal};t&&(a.mainAccount=t.name,a.appId=t.appId,a.mainAccountId=t.mainAccountId),this.setState(a)},showSubAccount:function(e,t){var a={appId:t};this.props.toggleModal("allSubAccount",a)},render:function(){return r.default.createElement("div",null,r.default.createElement(o.Table,{columns:this.state.columns,loading:this.props.tableData.loading,dataSource:this.props.tableData.data,pagination:this.props.tableData.pagination}),r.default.createElement(i.default,{mainAccountId:this.state.mainAccountId,appId:this.state.appId,homeCurrent:this.props.homeCurrent,onSearch:this.props.onSearch,toggleModal:this.toggleModal,mainAccount:this.state.mainAccount,showMainAccountModal:this.state.showMainAccountModal}))}});e.exports=u},1402:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r=a(600),o=n(r),s=a(783),i=a(776),u=n(i),c=a(785),p=n(c),d=s.Form.Item,h={labelCol:{span:5},wrapperCol:{span:19}},m=o.default.createClass({displayName:"App",getInitialState:function(){return{liClass:"",loading:!1,currentData:[],jsonData:[],authData:[],authChecked:[],createSubAccount:this.props.createSubAccount}},handleSubmit:function(e){var t=this;e.preventDefault(),this.props.form.validateFields(function(e,a){return e?void console.log("Errors in form!!!"):(a.appId=t.props.appId,a.mainAccountId=t.props.mainAccountId,void p.default.post(u.default.changeMainAccount,a,function(){s.message.success("主账号更改成功"),t.props.toggleModal(),t.props.onSearch({index:t.props.homeCurrent,appId:a.appId}),t.props.form.setFieldsValue({newAccountName:""});var e=document.getElementById("userAuth")&&document.getElementById("userAuth").innerHTML;if(e<2){var n=u.default.logout+"?gotoURL="+encodeURIComponent(location.origin);window.location.href=n}}))})},render:function(){var e=this.props.form.getFieldProps,t=this;return o.default.createElement(s.Modal,{footer:null,title:"修改主账号",visible:this.props.showMainAccountModal,onCancel:this.props.toggleModal},o.default.createElement(s.Form,{horizontal:!0},o.default.createElement(d,l({},h,{label:"原主账号    "}),o.default.createElement("span",null,this.props.mainAccount)),o.default.createElement(d,l({},h,{label:"新账号    "}),o.default.createElement(d,null,o.default.createElement(s.Input,l({style:{width:190},placeholder:"Flyme账号"},e("newAccountName",{validate:[{rules:[{required:!0,message:"请输入Flyme账号"},{min:4,message:"Flyme账号不能少于4个字符"},{max:32,message:"Flyme账号不能多于32个字符"},{validator:function(e,a,n){a&&a.length>=4&&a.length<=32&&a===t.props.mainAccount?n(new Error("不能和现有的主账号同名")):n()}}],trigger:["onBlur","onChange"]}]}),{placeholder:"Flyme账号"}))),o.default.createElement("p",{className:"fs12  color999"},"修改主账号后, 控制台将退出登录, 需使用新账号才能重新登录管理")),o.default.createElement(d,l({},h,{label:" "}),o.default.createElement(s.Button,{className:"ml10 mt20",type:"primary",onClick:this.handleSubmit,size:"large"},"保存"))))}});m=s.Form.create()(m),e.exports=m}});